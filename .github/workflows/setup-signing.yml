
name: 1. Setup Android Signing (Run Once)

on:
  workflow_dispatch:

jobs:
  generate-keys:
    name: Generate Keystore & SHA-1
    runs-on: ubuntu-latest
    steps:
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'

      - name: Generate Keystore
        run: |
          # 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∫–ª—é—á–µ–π
          keytool -genkeypair -v \
            -keystore my-release-key.jks \
            -keyalg RSA \
            -keysize 2048 \
            -validity 10000 \
            -alias my-key-alias \
            -dname "CN=FamilyBudget, OU=BudgetApp, O=Family, L=City, S=State, C=US" \
            -storepass "password123" \
            -keypass "password123"

          echo "‚úÖ Keystore generated successfully."

      - name: Get SHA-1 Fingerprint (For Firebase)
        run: |
          echo "========================================================"
          echo "üëá COPY THIS SHA-1 TO FIREBASE CONSOLE üëá"
          echo "========================================================"
          keytool -list -v -keystore my-release-key.jks -alias my-key-alias -storepass "password123" | grep "SHA1:"
          echo "========================================================"

      - name: Encode Keystore to Base64 (For GitHub Secrets)
        id: encode_key
        run: |
          # –ö–æ–¥–∏—Ä—É–µ–º —Ñ–∞–π–ª –∫–ª—é—á–∞ –≤ —Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö
          BASE64_KEY=$(base64 -w 0 my-release-key.jks)
          
          echo "========================================================"
          echo "üëá COPY THE TEXT BELOW TO GITHUB SECRET 'ANDROID_KEYSTORE_BASE64' üëá"
          echo "========================================================"
          echo "$BASE64_KEY"
          echo "========================================================"
