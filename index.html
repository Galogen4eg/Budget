<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Семейный Бюджет</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            color: #1e293b;
        }
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
        }
        header {
            background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .logo-icon {
            background: white;
            width: 36px;
            height: 36px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7c3aed;
            font-size: 18px;
        }
        nav {
            display: flex;
            gap: 8px;
        }
        .nav-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 8px;
            transition: all 0.2s;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
        }
        .nav-button.active {
            background: rgba(255, 255, 255, 0.3);
        }
        .nav-button:not(.active):hover {
            background: rgba(255, 255, 255, 0.3);
        }
        main {
            padding: 24px 0;
        }
        .grid {
            display: grid;
            gap: 24px;
        }
        .grid-cols-1 {
            grid-template-columns: 1fr;
        }
        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }
        .grid-cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 24px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }
        .flex {
            display: flex;
        }
        .items-center {
            align-items: center;
        }
        .justify-between {
            justify-content: space-between;
        }
        .justify-end {
            justify-content: flex-end;
        }
        .justify-center {
            justify-content: center;
        }
        .space-x-2 > * + * {
            margin-left: 8px;
        }
        .space-x-3 > * + * {
            margin-left: 12px;
        }
        .space-x-4 > * + * {
            margin-left: 16px;
        }
        .space-y-2 > * + * {
            margin-top: 8px;
        }
        .space-y-3 > * + * {
            margin-top: 12px;
        }
        .space-y-4 > * + * {
            margin-top: 16px;
        }
        .space-y-6 > * + * {
            margin-top: 24px;
        }
        .text-gray-600 {
            color: #71717a;
        }
        .text-green-600 {
            color: #16a34a;
        }
        .text-red-600 {
            color: #dc2626;
        }
        .text-blue-500 {
            color: #3b82f6;
        }
        .text-purple-500 {
            color: #a855f7;
        }
        .text-orange-600 {
            color: #ea580c;
        }
        .text-yellow-500 {
            color: #eab308;
        }
        .text-gray-500 {
            color: #a1a1aa;
        }
        .text-gray-400 {
            color: #d4d4d8;
        }
        .text-gray-700 {
            color: #52525b;
        }
        .text-gray-800 {
            color: #27272a;
        }
        .text-white {
            color: white;
        }
        .bg-white {
            background: white;
        }
        .bg-purple-600 {
            background: #7c3aed;
        }
        .bg-purple-100 {
            background: #f3e8ff;
        }
        .bg-green-100 {
            background: #dcfce7;
        }
        .bg-red-100 {
            background: #fee2e2;
        }
        .bg-blue-100 {
            background: #dbeafe;
        }
        .bg-yellow-100 {
            background: #fef9c3;
        }
        .bg-gray-50 {
            background: #fafafa;
        }
        .bg-gray-100 {
            background: #f4f4f5;
        }
        .bg-gray-200 {
            background: #e4e4e7;
        }
        .bg-purple-50 {
            background: #f5f3ff;
        }
        .bg-red-500 {
            background: #ef4444;
        }
        .bg-green-500 {
            background: #16a34a;
        }
        .bg-blue-500 {
            background: #3b82f6;
        }
        .bg-pink-500 {
            background: #ec4899;
        }
        .bg-yellow-500 {
            background: #eab308;
        }
        .bg-purple-500 {
            background: #a855f7;
        }
        .bg-indigo-500 {
            background: #6366f1;
        }
        .bg-teal-500 {
            background: #14b8a6;
        }
        .rounded {
            border-radius: 6px;
        }
        .rounded-lg {
            border-radius: 8px;
        }
        .rounded-full {
            border-radius: 9999px;
        }
        .rounded-xl {
            border-radius: 12px;
        }
        .p-2 {
            padding: 8px;
        }
        .p-3 {
            padding: 12px;
        }
        .p-4 {
            padding: 16px;
        }
        .p-6 {
            padding: 24px;
        }
        .px-3 {
            padding-left: 12px;
            padding-right: 12px;
        }
        .px-4 {
            padding-left: 16px;
            padding-right: 16px;
        }
        .px-6 {
            padding-left: 24px;
            padding-right: 24px;
        }
        .py-2 {
            padding-top: 8px;
            padding-bottom: 8px;
        }
        .py-3 {
            padding-top: 12px;
            padding-bottom: 12px;
        }
        .py-4 {
            padding-top: 16px;
            padding-bottom: 16px;
        }
        .mb-2 {
            margin-bottom: 8px;
        }
        .mb-3 {
            margin-bottom: 12px;
        }
        .mb-4 {
            margin-bottom: 16px;
        }
        .mb-6 {
            margin-bottom: 24px;
        }
        .mt-2 {
            margin-top: 8px;
        }
        .mt-3 {
            margin-top: 12px;
        }
        .mt-4 {
            margin-top: 16px;
        }
        .ml-2 {
            margin-left: 8px;
        }
        .font-bold {
            font-weight: 700;
        }
        .font-semibold {
            font-weight: 600;
        }
        .font-medium {
            font-weight: 500;
        }
        .text-xl {
            font-size: 1.25rem;
            line-height: 1.75rem;
        }
        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem;
        }
        .text-base {
            font-size: 1rem;
            line-height: 1.5rem;
        }
        .text-sm {
            font-size: 0.875rem;
            line-height: 1.25rem;
        }
        .text-xs {
            font-size: 0.75rem;
            line-height: 1rem;
        }
        .w-full {
            width: 100%;
        }
        .h-2 {
            height: 0.5rem;
        }
        .h-3 {
            height: 0.75rem;
        }
        .h-4 {
            height: 1rem;
        }
        .w-3 {
            width: 0.75rem;
        }
        .w-4 {
            width: 1rem;
        }
        .border {
            border: 1px solid;
        }
        .border-b {
            border-bottom: 1px solid;
        }
        .border-gray-100 {
            border-color: #f1f5f9;
        }
        .border-gray-200 {
            border-color: #e2e8f0;
        }
        .border-gray-300 {
            border-color: #cbd5e1;
        }
        .border-transparent {
            border-color: transparent;
        }
        .border-green-500 {
            border-color: #16a34a;
        }
        .border-red-500 {
            border-color: #dc2626;
        }
        .cursor-pointer {
            cursor: pointer;
        }
        .transition-all {
            transition-property: all;
            transition-duration: 0.2s;
        }
        .transition-colors {
            transition-property: background-color, border-color, color;
            transition-duration: 0.2s;
        }
        .shadow-sm {
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        .shadow {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .relative {
            position: relative;
        }
        .absolute {
            position: absolute;
        }
        .z-10 {
            z-index: 10;
        }
        .z-50 {
            z-index: 50;
        }
        .sticky {
            position: sticky;
        }
        .top-0 {
            top: 0;
        }
        .overflow-x-auto {
            overflow-x: auto;
        }
        .overflow-y-auto {
            overflow-y: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .line-through {
            text-decoration: line-through;
        }
        input, select, textarea {
            font-family: inherit;
            font-size: 0.875rem;
            line-height: 1.25rem;
            margin: 0;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            padding: 8px 12px;
            transition: all 0.2s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }
        button {
            cursor: pointer;
            border: none;
            background: none;
            font-family: inherit;
            font-size: 0.875rem;
            line-height: 1.25rem;
            margin: 0;
        }
        .btn-primary {
            background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%);
            color: white;
            border-radius: 6px;
            padding: 8px 16px;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4338ca 100%);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
            transform: translateY(-1px);
        }
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            border-radius: 6px;
            padding: 8px 16px;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
        }
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        .btn-danger {
            background: #fee2e2;
            color: #dc2626;
            border-radius: 6px;
            padding: 8px 16px;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
        }
        .btn-danger:hover {
            background: #fecaca;
        }
        /* Auth styles */
        .auth-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 450px;
            width: 90%;
            padding: 32px;
            text-align: center;
        }
        .auth-header {
            margin-bottom: 32px;
        }
        .auth-header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }
        .auth-header p {
            color: #64748b;
            font-size: 1rem;
        }
        .mode-toggle {
            display: flex;
            background: #f1f5f9;
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 24px;
            position: relative;
        }
        .mode-toggle-slider {
            position: absolute;
            background: white;
            border-radius: 6px;
            height: calc(100% - 8px);
            transition: left 0.3s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .mode-toggle-btn {
            flex: 1;
            padding: 12px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            z-index: 2;
            transition: color 0.2s;
        }
        .mode-toggle-btn.active {
            color: #7c3aed;
        }
        .mode-toggle-btn:not(.active) {
            color: #64748b;
        }
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #334155;
        }
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }
        .form-input.error {
            border-color: #ef4444;
        }
        .btn-auth {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(124, 58, 237, 0.1);
        }
        .btn-auth:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4338ca 100%);
            box-shadow: 0 6px 8px rgba(124, 58, 237, 0.2);
            transform: translateY(-1px);
        }
        .auth-features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 32px;
        }
        .feature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .feature-icon {
            width: 48px;
            height: 48px;
            background: #f1f5f9;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            color: #7c3aed;
            font-size: 1.25rem;
        }
        .feature-text {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
        }
        .error-message {
            color: #ef4444;
            background: #fee2e2;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .success-message {
            color: #16a34a;
            background: #dcfce7;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            padding: 24px;
            color: #7c3aed;
        }
        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid rgba(124, 58, 237, 0.2);
            border-top: 3px solid #7c3aed;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Calendar styles */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }
        .calendar-header-cell {
            background-color: #f8fafc;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 0.875rem;
            color: #64748b;
        }
        .calendar-day-cell {
            background-color: white;
            min-height: 100px;
            padding: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid #f1f5f9;
        }
        .calendar-day-cell:hover {
            background-color: #f8f9ff;
        }
        .calendar-day-cell.other-month {
            background-color: #f8fafc;
            color: #94a3b8;
        }
        .calendar-day-number {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 4px;
        }
        .calendar-events-container {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .calendar-event-item {
            font-size: 0.75rem;
            padding: 2px 4px;
            border-radius: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: white;
            font-weight: 500;
        }
        .calendar-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }
        .calendar-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }
        .calendar-nav-button {
            background-color: #f1f5f9;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .calendar-nav-button:hover {
            background-color: #e2e8f0;
        }
        .calendar-today-button {
            background-color: #7c3aed;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
            margin: 0 auto;
        }
        .calendar-today-button:hover {
            background-color: #6d28d9;
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
            transform: translateY(-1px);
        }
        .selected-day {
            background-color: #e0e7ff !important;
            border: 2px solid #4f46e5;
        }
        /* Week calendar styles */
        .week-calendar {
            display: grid;
            grid-template-columns: 60px repeat(7, 1fr);
            gap: 1px;
            background-color: #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }
        .week-time-column {
            background-color: #f8fafc;
            padding: 4px;
            text-align: center;
            font-weight: 600;
            font-size: 0.75rem;
            color: #64748b;
        }
        .week-hour-cell {
            background-color: white;
            min-height: 40px;
            padding: 2px;
            border: 1px solid #f1f5f9;
        }
        .week-hour-cell.selected {
            background-color: #e0e7ff;
        }
        /* Color picker */
        .color-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .color-option:hover {
            transform: scale(1.1);
        }
        .color-option.selected {
            border-color: #000;
            transform: scale(1.1);
        }
        /* Participant chips */
        .participant-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        .participant-chip {
            background: #e0e7ff;
            color: #4f46e5;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }
        .participant-chip.selected {
            background: #7c3aed;
            color: white;
        }
        .participant-chip .remove-participant {
            cursor: pointer;
            font-size: 0.7rem;
        }
        /* Template item */
        .template-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .template-item:hover {
            background: #f8fafc;
        }
        .template-item-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        .template-item-actions {
            display: flex;
            gap: 8px;
        }
        /* Collapsible */
        .collapsible-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        .collapsible-content {
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-content.collapsed {
            max-height: 0;
        }
        .collapsible-content.expanded {
            max-height: 1000px;
        }
        /* Categories */
        .categories-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 16px;
        }
        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f1f5f9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
        }
        .category-item.active {
            background: #7c3aed;
            color: white;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
        }
        .category-item:hover:not(.active) {
            background: #e2e8f0;
        }
        /* File upload */
        .file-upload {
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #f8fafc;
        }
        .file-upload:hover {
            border-color: #7c3aed;
            background: #f0f4ff;
        }
        .file-upload i {
            font-size: 2rem;
            color: #7c3aed;
            margin-bottom: 16px;
        }
        .file-upload p {
            margin-bottom: 16px;
            color: #64748b;
        }
        .file-upload input[type="file"] {
            display: none;
        }
        /* Shopping list two columns */
        .shopping-list-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        .shopping-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            transition: all 0.2s;
            cursor: pointer;
        }
        .shopping-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        .shopping-item-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        .shopping-item-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #cbd5e1;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .shopping-item-checkbox.checked {
            background: #16a34a;
            border-color: #16a34a;
        }
        .shopping-item-checkbox.checked i {
            color: white;
            font-size: 12px;
        }
        .shopping-item-text {
            font-size: 0.95rem;
        }
        .shopping-item-text.completed {
            text-decoration: line-through;
            color: #94a3b8;
        }
        .shopping-item-actions {
            display: flex;
            gap: 8px;
        }
        .shopping-item-edit {
            color: #7c3aed;
            cursor: pointer;
        }
        .shopping-item-delete {
            color: #ef4444;
            cursor: pointer;
        }
        .shopping-item-input {
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.95rem;
            width: 100%;
        }
        /* Participants */
        .participants-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        .participant-tag {
            background: #e0e7ff;
            color: #4f46e5;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .participant-tag .remove-participant {
            cursor: pointer;
            font-size: 0.7rem;
        }
        .add-participant-input {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .modal-content {
            background: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
        }
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #94a3b8;
        }
        .modal-body {
            padding: 24px;
        }
        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        /* Preview table */
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        .preview-table th,
        .preview-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        .preview-table th {
            background-color: #f8fafc;
            font-weight: 600;
        }
        /* Event item alignment */
        .event-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }
        .event-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        .event-color-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .event-info {
            flex: 1;
        }
        .event-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        /* Template chip */
        .template-chip {
            background: #e0e7ff;
            color: #4f46e5;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }
        /* Toggle switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #7c3aed;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        .tab-setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }
        /* Template chips */
        .template-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        .template-chip-item {
            background: #e0e7ff;
            color: #4f46e5;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .template-chip-item:hover {
            background: #c7d2fe;
            transform: translateY(-1px);
        }
        /* Participant creation */
        .participant-creation {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            align-items: center;
        }
        .color-preview {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #e2e8f0;
        }
        /* Color picker grid */
        .color-picker-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        .color-picker-item {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .color-picker-item:hover {
            transform: scale(1.1);
        }
        .color-picker-item.selected {
            border-color: #000;
            transform: scale(1.1);
        }
        /* Fixed expense item */
        .fixed-expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }
        .fixed-expense-name {
            flex: 1;
        }
        .fixed-expense-amount {
            font-weight: bold;
            margin-right: 16px;
        }
        .fixed-expense-delete {
            color: #ef4444;
            cursor: pointer;
        }
        /* Participant color selector */
        .participant-color-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }
        .color-option-small {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .color-option-small.selected {
            border-color: #000;
        }
        /* Confirmation modal */
        .confirmation-modal {
            background: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 400px;
            width: 90%;
            padding: 24px;
            text-align: center;
        }
        .confirmation-modal h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
        }
        .confirmation-modal p {
            color: #64748b;
            margin-bottom: 24px;
        }
        .confirmation-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
        }
        /* Mobile responsive */
        @media (max-width: 768px) {
            .app-container {
                padding: 0 12px;
            }
            .header-content {
                flex-direction: column;
                gap: 16px;
                padding: 16px 0;
            }
            .logo {
                font-size: 1.25rem;
            }
            nav {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 6px;
            }
            .nav-button {
                padding: 8px 12px;
                font-size: 0.875rem;
            }
            main {
                padding: 16px 0;
            }
            .card {
                padding: 16px;
                border-radius: 12px;
            }
            .grid {
                gap: 16px;
            }
            .grid-cols-2 {
                grid-template-columns: 1fr;
            }
            .grid-cols-3 {
                grid-template-columns: 1fr;
            }
            .grid-cols-4 {
                grid-template-columns: 1fr;
            }
            .calendar-day-cell {
                min-height: 80px;
                padding: 6px;
            }
            .calendar-header-cell {
                padding: 8px 4px;
                font-size: 0.75rem;
            }
            .calendar-navigation {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            .calendar-navigation > div:first-child {
                order: 1;
            }
            .calendar-navigation > div:last-child {
                order: 2;
                display: flex;
                justify-content: center;
            }
            .calendar-navigation > div:nth-child(2) {
                order: 3;
                display: flex;
                justify-content: center;
                gap: 8px;
            }
            /* Shopping list two columns on mobile */
            .shopping-list-grid {
                grid-template-columns: 1fr;
            }
            .auth-container {
                padding: 24px;
            }
            .auth-features {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }
        @media (max-width: 480px) {
            .app-container {
                padding: 0 8px;
            }
            .header-content {
                padding: 12px 0;
            }
            nav {
                gap: 4px;
            }
            .nav-button {
                padding: 6px 10px;
                font-size: 0.75rem;
            }
            .card {
                padding: 12px;
            }
            .calendar-day-cell {
                min-height: 60px;
                padding: 4px;
            }
            .calendar-event-item {
                font-size: 0.625rem;
                padding: 1px 2px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB5C3tMzDj7KJQZrOu6q1vW8N9x0a2b3c4",
            authDomain: "family-budget-app.firebaseapp.com",
            projectId: "family-budget-app",
            storageBucket: "family-budget-app.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890abcdef",
            databaseURL: "https://family-budget-app-default-rtdb.firebaseio.com/"
        };
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        // Get Realtime Database reference
        const db = firebase.database();
        // Оптимизированный компонент приложения
        const FamilyBudgetApp = () => {
            const [activeTab, setActiveTab] = useState('budget');
            const [currentRoom, setCurrentRoom] = useState(null);
            const [showRoomModal, setShowRoomModal] = useState(true);
            const [roomMode, setRoomMode] = useState('join');
            const [roomId, setRoomId] = useState('');
            const [roomName, setRoomName] = useState('');
            const [roomPassword, setRoomPassword] = useState('');
            const [roomError, setRoomError] = useState('');
            const [roomSuccess, setRoomSuccess] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [showAllTime, setShowAllTime] = useState(false);
            const [user, setUser] = useState(null);
            const [authMode, setAuthMode] = useState('login'); // login or register
            // Tab visibility settings (только для покупок и планировщика)
            const [tabVisibility, setTabVisibility] = useState({
                shopping: true,
                planner: true
            });
            // Budget states
            const [transactions, setTransactions] = useState([
                { id: 1, type: 'income', amount: 50000, category: 'Зарплата', date: '2024-01-15', description: 'Зарплата Ивана', balanceAfter: 50000 },
                { id: 2, type: 'expense', amount: 15000, category: 'Продукты', date: '2024-01-16', description: 'Покупка продуктов', balanceAfter: 35000 },
                { id: 3, type: 'expense', amount: 8000, category: 'Транспорт', date: '2024-01-17', description: 'Бензин', balanceAfter: 27000 },
                { id: 4, type: 'expense', amount: 5000, category: 'Продукты', date: '2024-01-18', description: 'Овощи и фрукты', balanceAfter: 22000 },
                { id: 5, type: 'expense', amount: 3000, category: 'Развлечения', date: '2024-01-19', description: 'Кино', balanceAfter: 19000 }
            ]);
            const [initialBalance, setInitialBalance] = useState(0);
            const [newTransaction, setNewTransaction] = useState({
                type: 'expense',
                amount: '',
                category: 'Продукты',
                date: new Date().toISOString().split('T')[0],
                description: ''
            });
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedDate, setSelectedDate] = useState(null);
            const [showAddTransaction, setShowAddTransaction] = useState(false);
            // Shopping list states
            const [shoppingList, setShoppingList] = useState([
                { id: 1, item: 'Молоко', quantity: 1, unit: 'литр', completed: false },
                { id: 2, item: 'Хлеб', quantity: 2, unit: 'штука', completed: true },
                { id: 3, item: 'Яблоки', quantity: 3, unit: 'килограмм', completed: false }
            ]);
            const [newItem, setNewItem] = useState({ name: '', quantity: '', unit: 'штука' });
            const [editingItemId, setEditingItemId] = useState(null);
            const [editingItemText, setEditingItemText] = useState('');
            const [editingItemQuantity, setEditingItemQuantity] = useState('');
            const [editingItemUnit, setEditingItemUnit] = useState('штука');
            const [showAddShoppingItem, setShowAddShoppingItem] = useState(false);
            // Calendar states
            const [calendarEvents, setCalendarEvents] = useState([
                {
                    id: 1,
                    title: 'Встреча с клиентом',
                    startDate: '2024-01-20',
                    startTime: '10:00',
                    endTime: '11:30',
                    color: 'bg-blue-500',
                    participants: ['Иван'],
                    isTemplate: false
                },
                {
                    id: 2,
                    title: 'Тренировка',
                    startDate: '2024-01-21',
                    startTime: '18:00',
                    endTime: '19:30',
                    color: 'bg-green-500',
                    participants: ['Мария'],
                    isTemplate: false
                }
            ]);
            const [newEvent, setNewEvent] = useState({
                title: '',
                startDate: new Date().toISOString().split('T')[0],
                startTime: '09:00',
                endTime: '',
                color: 'bg-blue-500',
                participants: [],
                isTemplate: false
            });
            const [editingEvent, setEditingEvent] = useState(null);
            const [showAddEventModal, setShowAddEventModal] = useState(false);
            const [showEditEventModal, setShowEditEventModal] = useState(false);
            const [showCreateTemplateModal, setShowCreateTemplateModal] = useState(false);
            const [currentDate, setCurrentDate] = useState(new Date());
            const [calendarView, setCalendarView] = useState('month');
            const [plannerCalendarView, setPlannerCalendarView] = useState('month'); // Separate view for planner
            // Settings
            const [savingsPercentage, setSavingsPercentage] = useState('');
            const [showBudgetSettings, setShowBudgetSettings] = useState(false);
            const [showShoppingSettings, setShowShoppingSettings] = useState(false);
            const [showPlannerSettings, setShowPlannerSettings] = useState(false);
            // Day settings
            const [dayStart, setDayStart] = useState('08:00');
            const [dayEnd, setDayEnd] = useState('20:00');
            // Participants
            const [participants, setParticipants] = useState([
                { name: 'Иван', color: 'bg-blue-500' },
                { name: 'Мария', color: 'bg-green-500' },
                { name: 'Алексей', color: 'bg-purple-500' }
            ]);
            const [newParticipant, setNewParticipant] = useState('');
            const [selectedParticipantColor, setSelectedParticipantColor] = useState('bg-blue-500');
            const [showAddParticipantModal, setShowAddParticipantModal] = useState(false);
            // Templates
            const [templates, setTemplates] = useState([
                { id: 1, name: 'Танцы' },
                { id: 2, name: 'Врач' },
                { id: 3, name: 'Тренировка' },
                { id: 4, name: 'Вокал' }
            ]);
            const [newTemplateName, setNewTemplateName] = useState('');
            // Shopping settings
            const [telegramBotToken, setTelegramBotToken] = useState('');
            const [telegramChatId, setTelegramChatId] = useState('');
            // File upload preview
            const [previewData, setPreviewData] = useState([]);
            const [showPreviewModal, setShowPreviewModal] = useState(false);
            // Fixed expenses
            const [fixedExpenses, setFixedExpenses] = useState([
                { id: 1, name: 'Аренда квартиры', amount: 15000, category: 'Жилье' },
                { id:

+++ index.html (修改后)
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Семейный Бюджет</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            color: #1e293b;
        }
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
        }
        header {
            background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .logo-icon {
            background: white;
            width: 36px;
            height: 36px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7c3aed;
            font-size: 18px;
        }
        nav {
            display: flex;
            gap: 8px;
        }
        .nav-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 8px;
            transition: all 0.2s;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
        }
        .nav-button.active {
            background: rgba(255, 255, 255, 0.3);
        }
        .nav-button:not(.active):hover {
            background: rgba(255, 255, 255, 0.3);
        }
        main {
            padding: 24px 0;
        }
        .grid {
            display: grid;
            gap: 24px;
        }
        .grid-cols-1 {
            grid-template-columns: 1fr;
        }
        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }
        .grid-cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 24px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }
        .flex {
            display: flex;
        }
        .items-center {
            align-items: center;
        }
        .justify-between {
            justify-content: space-between;
        }
        .justify-end {
            justify-content: flex-end;
        }
        .justify-center {
            justify-content: center;
        }
        .space-x-2 > * + * {
            margin-left: 8px;
        }
        .space-x-3 > * + * {
            margin-left: 12px;
        }
        .space-x-4 > * + * {
            margin-left: 16px;
        }
        .space-y-2 > * + * {
            margin-top: 8px;
        }
        .space-y-3 > * + * {
            margin-top: 12px;
        }
        .space-y-4 > * + * {
            margin-top: 16px;
        }
        .space-y-6 > * + * {
            margin-top: 24px;
        }
        .text-gray-600 {
            color: #71717a;
        }
        .text-green-600 {
            color: #16a34a;
        }
        .text-red-600 {
            color: #dc2626;
        }
        .text-blue-500 {
            color: #3b82f6;
        }
        .text-purple-500 {
            color: #a855f7;
        }
        .text-orange-600 {
            color: #ea580c;
        }
        .text-yellow-500 {
            color: #eab308;
        }
        .text-gray-500 {
            color: #a1a1aa;
        }
        .text-gray-400 {
            color: #d4d4d8;
        }
        .text-gray-700 {
            color: #52525b;
        }
        .text-gray-800 {
            color: #27272a;
        }
        .text-white {
            color: white;
        }
        .bg-white {
            background: white;
        }
        .bg-purple-600 {
            background: #7c3aed;
        }
        .bg-purple-100 {
            background: #f3e8ff;
        }
        .bg-green-100 {
            background: #dcfce7;
        }
        .bg-red-100 {
            background: #fee2e2;
        }
        .bg-blue-100 {
            background: #dbeafe;
        }
        .bg-yellow-100 {
            background: #fef9c3;
        }
        .bg-gray-50 {
            background: #fafafa;
        }
        .bg-gray-100 {
            background: #f4f4f5;
        }
        .bg-gray-200 {
            background: #e4e4e7;
        }
        .bg-purple-50 {
            background: #f5f3ff;
        }
        .bg-red-500 {
            background: #ef4444;
        }
        .bg-green-500 {
            background: #16a34a;
        }
        .bg-blue-500 {
            background: #3b82f6;
        }
        .bg-pink-500 {
            background: #ec4899;
        }
        .bg-yellow-500 {
            background: #eab308;
        }
        .bg-purple-500 {
            background: #a855f7;
        }
        .bg-indigo-500 {
            background: #6366f1;
        }
        .bg-teal-500 {
            background: #14b8a6;
        }
        .rounded {
            border-radius: 6px;
        }
        .rounded-lg {
            border-radius: 8px;
        }
        .rounded-full {
            border-radius: 9999px;
        }
        .rounded-xl {
            border-radius: 12px;
        }
        .p-2 {
            padding: 8px;
        }
        .p-3 {
            padding: 12px;
        }
        .p-4 {
            padding: 16px;
        }
        .p-6 {
            padding: 24px;
        }
        .px-3 {
            padding-left: 12px;
            padding-right: 12px;
        }
        .px-4 {
            padding-left: 16px;
            padding-right: 16px;
        }
        .px-6 {
            padding-left: 24px;
            padding-right: 24px;
        }
        .py-2 {
            padding-top: 8px;
            padding-bottom: 8px;
        }
        .py-3 {
            padding-top: 12px;
            padding-bottom: 12px;
        }
        .py-4 {
            padding-top: 16px;
            padding-bottom: 16px;
        }
        .mb-2 {
            margin-bottom: 8px;
        }
        .mb-3 {
            margin-bottom: 12px;
        }
        .mb-4 {
            margin-bottom: 16px;
        }
        .mb-6 {
            margin-bottom: 24px;
        }
        .mt-2 {
            margin-top: 8px;
        }
        .mt-3 {
            margin-top: 12px;
        }
        .mt-4 {
            margin-top: 16px;
        }
        .ml-2 {
            margin-left: 8px;
        }
        .font-bold {
            font-weight: 700;
        }
        .font-semibold {
            font-weight: 600;
        }
        .font-medium {
            font-weight: 500;
        }
        .text-xl {
            font-size: 1.25rem;
            line-height: 1.75rem;
        }
        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem;
        }
        .text-base {
            font-size: 1rem;
            line-height: 1.5rem;
        }
        .text-sm {
            font-size: 0.875rem;
            line-height: 1.25rem;
        }
        .text-xs {
            font-size: 0.75rem;
            line-height: 1rem;
        }
        .w-full {
            width: 100%;
        }
        .h-2 {
            height: 0.5rem;
        }
        .h-3 {
            height: 0.75rem;
        }
        .h-4 {
            height: 1rem;
        }
        .w-3 {
            width: 0.75rem;
        }
        .w-4 {
            width: 1rem;
        }
        .border {
            border: 1px solid;
        }
        .border-b {
            border-bottom: 1px solid;
        }
        .border-gray-100 {
            border-color: #f1f5f9;
        }
        .border-gray-200 {
            border-color: #e2e8f0;
        }
        .border-gray-300 {
            border-color: #cbd5e1;
        }
        .border-transparent {
            border-color: transparent;
        }
        .border-green-500 {
            border-color: #16a34a;
        }
        .border-red-500 {
            border-color: #dc2626;
        }
        .cursor-pointer {
            cursor: pointer;
        }
        .transition-all {
            transition-property: all;
            transition-duration: 0.2s;
        }
        .transition-colors {
            transition-property: background-color, border-color, color;
            transition-duration: 0.2s;
        }
        .shadow-sm {
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        .shadow {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .relative {
            position: relative;
        }
        .absolute {
            position: absolute;
        }
        .z-10 {
            z-index: 10;
        }
        .z-50 {
            z-index: 50;
        }
        .sticky {
            position: sticky;
        }
        .top-0 {
            top: 0;
        }
        .overflow-x-auto {
            overflow-x: auto;
        }
        .overflow-y-auto {
            overflow-y: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .line-through {
            text-decoration: line-through;
        }
        input, select, textarea {
            font-family: inherit;
            font-size: 0.875rem;
            line-height: 1.25rem;
            margin: 0;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            padding: 8px 12px;
            transition: all 0.2s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }
        button {
            cursor: pointer;
            border: none;
            background: none;
            font-family: inherit;
            font-size: 0.875rem;
            line-height: 1.25rem;
            margin: 0;
        }
        .btn-primary {
            background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%);
            color: white;
            border-radius: 6px;
            padding: 8px 16px;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4338ca 100%);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
            transform: translateY(-1px);
        }
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            border-radius: 6px;
            padding: 8px 16px;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
        }
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        .btn-danger {
            background: #fee2e2;
            color: #dc2626;
            border-radius: 6px;
            padding: 8px 16px;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
        }
        .btn-danger:hover {
            background: #fecaca;
        }
        /* Auth styles */
        .auth-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 450px;
            width: 90%;
            padding: 32px;
            text-align: center;
        }
        .auth-header {
            margin-bottom: 32px;
        }
        .auth-header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }
        .auth-header p {
            color: #64748b;
            font-size: 1rem;
        }
        .mode-toggle {
            display: flex;
            background: #f1f5f9;
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 24px;
            position: relative;
        }
        .mode-toggle-slider {
            position: absolute;
            background: white;
            border-radius: 6px;
            height: calc(100% - 8px);
            transition: left 0.3s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .mode-toggle-btn {
            flex: 1;
            padding: 12px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            z-index: 2;
            transition: color 0.2s;
        }
        .mode-toggle-btn.active {
            color: #7c3aed;
        }
        .mode-toggle-btn:not(.active) {
            color: #64748b;
        }
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #334155;
        }
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }
        .form-input.error {
            border-color: #ef4444;
        }
        .btn-auth {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(124, 58, 237, 0.1);
        }
        .btn-auth:hover {
            background: linear-gradient(135deg, #6d28d9 0%, #4338ca 100%);
            box-shadow: 0 6px 8px rgba(124, 58, 237, 0.2);
            transform: translateY(-1px);
        }
        .auth-features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 32px;
        }
        .feature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .feature-icon {
            width: 48px;
            height: 48px;
            background: #f1f5f9;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            color: #7c3aed;
            font-size: 1.25rem;
        }
        .feature-text {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
        }
        .error-message {
            color: #ef4444;
            background: #fee2e2;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .success-message {
            color: #16a34a;
            background: #dcfce7;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            padding: 24px;
            color: #7c3aed;
        }
        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid rgba(124, 58, 237, 0.2);
            border-top: 3px solid #7c3aed;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Calendar styles */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }
        .calendar-header-cell {
            background-color: #f8fafc;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 0.875rem;
            color: #64748b;
        }
        .calendar-day-cell {
            background-color: white;
            min-height: 100px;
            padding: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid #f1f5f9;
        }
        .calendar-day-cell:hover {
            background-color: #f8f9ff;
        }
        .calendar-day-cell.other-month {
            background-color: #f8fafc;
            color: #94a3b8;
        }
        .calendar-day-number {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 4px;
        }
        .calendar-events-container {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .calendar-event-item {
            font-size: 0.75rem;
            padding: 2px 4px;
            border-radius: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: white;
            font-weight: 500;
        }
        .calendar-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }
        .calendar-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }
        .calendar-nav-button {
            background-color: #f1f5f9;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .calendar-nav-button:hover {
            background-color: #e2e8f0;
        }
        .calendar-today-button {
            background-color: #7c3aed;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
            margin: 0 auto;
        }
        .calendar-today-button:hover {
            background-color: #6d28d9;
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
            transform: translateY(-1px);
        }
        .selected-day {
            background-color: #e0e7ff !important;
            border: 2px solid #4f46e5;
        }
        /* Week calendar styles */
        .week-calendar {
            display: grid;
            grid-template-columns: 60px repeat(7, 1fr);
            gap: 1px;
            background-color: #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }
        .week-time-column {
            background-color: #f8fafc;
            padding: 4px;
            text-align: center;
            font-weight: 600;
            font-size: 0.75rem;
            color: #64748b;
        }
        .week-hour-cell {
            background-color: white;
            min-height: 40px;
            padding: 2px;
            border: 1px solid #f1f5f9;
        }
        .week-hour-cell.selected {
            background-color: #e0e7ff;
        }
        /* Color picker */
        .color-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .color-option:hover {
            transform: scale(1.1);
        }
        .color-option.selected {
            border-color: #000;
            transform: scale(1.1);
        }
        /* Participant chips */
        .participant-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        .participant-chip {
            background: #e0e7ff;
            color: #4f46e5;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }
        .participant-chip.selected {
            background: #7c3aed;
            color: white;
        }
        .participant-chip .remove-participant {
            cursor: pointer;
            font-size: 0.7rem;
        }
        /* Template item */
        .template-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .template-item:hover {
            background: #f8fafc;
        }
        .template-item-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        .template-item-actions {
            display: flex;
            gap: 8px;
        }
        /* Collapsible */
        .collapsible-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        .collapsible-content {
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-content.collapsed {
            max-height: 0;
        }
        .collapsible-content.expanded {
            max-height: 1000px;
        }
        /* Categories */
        .categories-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 16px;
        }
        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f1f5f9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
        }
        .category-item.active {
            background: #7c3aed;
            color: white;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
        }
        .category-item:hover:not(.active) {
            background: #e2e8f0;
        }
        /* File upload */
        .file-upload {
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #f8fafc;
        }
        .file-upload:hover {
            border-color: #7c3aed;
            background: #f0f4ff;
        }
        .file-upload i {
            font-size: 2rem;
            color: #7c3aed;
            margin-bottom: 16px;
        }
        .file-upload p {
            margin-bottom: 16px;
            color: #64748b;
        }
        .file-upload input[type="file"] {
            display: none;
        }
        /* Shopping list two columns */
        .shopping-list-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        .shopping-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            transition: all 0.2s;
            cursor: pointer;
        }
        .shopping-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        .shopping-item-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        .shopping-item-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #cbd5e1;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .shopping-item-checkbox.checked {
            background: #16a34a;
            border-color: #16a34a;
        }
        .shopping-item-checkbox.checked i {
            color: white;
            font-size: 12px;
        }
        .shopping-item-text {
            font-size: 0.95rem;
        }
        .shopping-item-text.completed {
            text-decoration: line-through;
            color: #94a3b8;
        }
        .shopping-item-actions {
            display: flex;
            gap: 8px;
        }
        .shopping-item-edit {
            color: #7c3aed;
            cursor: pointer;
        }
        .shopping-item-delete {
            color: #ef4444;
            cursor: pointer;
        }
        .shopping-item-input {
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.95rem;
            width: 100%;
        }
        /* Participants */
        .participants-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        .participant-tag {
            background: #e0e7ff;
            color: #4f46e5;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .participant-tag .remove-participant {
            cursor: pointer;
            font-size: 0.7rem;
        }
        .add-participant-input {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .modal-content {
            background: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
        }
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #94a3b8;
        }
        .modal-body {
            padding: 24px;
        }
        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        /* Preview table */
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        .preview-table th,
        .preview-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        .preview-table th {
            background-color: #f8fafc;
            font-weight: 600;
        }
        /* Event item alignment */
        .event-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }
        .event-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        .event-color-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .event-info {
            flex: 1;
        }
        .event-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        /* Template chip */
        .template-chip {
            background: #e0e7ff;
            color: #4f46e5;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }
        /* Toggle switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #7c3aed;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        .tab-setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }
        /* Template chips */
        .template-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        .template-chip-item {
            background: #e0e7ff;
            color: #4f46e5;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .template-chip-item:hover {
            background: #c7d2fe;
            transform: translateY(-1px);
        }
        /* Participant creation */
        .participant-creation {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            align-items: center;
        }
        .color-preview {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #e2e8f0;
        }
        /* Color picker grid */
        .color-picker-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        .color-picker-item {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .color-picker-item:hover {
            transform: scale(1.1);
        }
        .color-picker-item.selected {
            border-color: #000;
            transform: scale(1.1);
        }
        /* Fixed expense item */
        .fixed-expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }
        .fixed-expense-name {
            flex: 1;
        }
        .fixed-expense-amount {
            font-weight: bold;
            margin-right: 16px;
        }
        .fixed-expense-delete {
            color: #ef4444;
            cursor: pointer;
        }
        /* Participant color selector */
        .participant-color-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }
        .color-option-small {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .color-option-small.selected {
            border-color: #000;
        }
        /* Confirmation modal */
        .confirmation-modal {
            background: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 400px;
            width: 90%;
            padding: 24px;
            text-align: center;
        }
        .confirmation-modal h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
        }
        .confirmation-modal p {
            color: #64748b;
            margin-bottom: 24px;
        }
        .confirmation-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
        }
        /* Mobile responsive */
        @media (max-width: 768px) {
            .app-container {
                padding: 0 12px;
            }
            .header-content {
                flex-direction: column;
                gap: 16px;
                padding: 16px 0;
            }
            .logo {
                font-size: 1.25rem;
            }
            nav {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 6px;
            }
            .nav-button {
                padding: 8px 12px;
                font-size: 0.875rem;
            }
            main {
                padding: 16px 0;
            }
            .card {
                padding: 16px;
                border-radius: 12px;
            }
            .grid {
                gap: 16px;
            }
            .grid-cols-2 {
                grid-template-columns: 1fr;
            }
            .grid-cols-3 {
                grid-template-columns: 1fr;
            }
            .grid-cols-4 {
                grid-template-columns: 1fr;
            }
            .calendar-day-cell {
                min-height: 80px;
                padding: 6px;
            }
            .calendar-header-cell {
                padding: 8px 4px;
                font-size: 0.75rem;
            }
            .calendar-navigation {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            .calendar-navigation > div:first-child {
                order: 1;
            }
            .calendar-navigation > div:last-child {
                order: 2;
                display: flex;
                justify-content: center;
            }
            .calendar-navigation > div:nth-child(2) {
                order: 3;
                display: flex;
                justify-content: center;
                gap: 8px;
            }
            /* Shopping list two columns on mobile */
            .shopping-list-grid {
                grid-template-columns: 1fr;
            }
            .auth-container {
                padding: 24px;
            }
            .auth-features {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }
        @media (max-width: 480px) {
            .app-container {
                padding: 0 8px;
            }
            .header-content {
                padding: 12px 0;
            }
            nav {
                gap: 4px;
            }
            .nav-button {
                padding: 6px 10px;
                font-size: 0.75rem;
            }
            .card {
                padding: 12px;
            }
            .calendar-day-cell {
                min-height: 60px;
                padding: 4px;
            }
            .calendar-event-item {
                font-size: 0.625rem;
                padding: 1px 2px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB5C3tMzDj7KJQZrOu6q1vW8N9x0a2b3c4",
            authDomain: "family-budget-app.firebaseapp.com",
            projectId: "family-budget-app",
            storageBucket: "family-budget-app.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890abcdef",
            databaseURL: "https://family-budget-app-default-rtdb.firebaseio.com/"
        };
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        // Get Realtime Database reference
        const db = firebase.database();
        // Оптимизированный компонент приложения
        const FamilyBudgetApp = () => {
            const [activeTab, setActiveTab] = useState('budget');
            const [currentRoom, setCurrentRoom] = useState(null);
            const [showRoomModal, setShowRoomModal] = useState(true);
            const [roomMode, setRoomMode] = useState('join');
            const [roomId, setRoomId] = useState('');
            const [roomName, setRoomName] = useState('');
            const [roomPassword, setRoomPassword] = useState('');
            const [roomError, setRoomError] = useState('');
            const [roomSuccess, setRoomSuccess] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [showAllTime, setShowAllTime] = useState(false);
            const [user, setUser] = useState(null);
            const [authMode, setAuthMode] = useState('login'); // login or register
            // Tab visibility settings (только для покупок и планировщика)
            const [tabVisibility, setTabVisibility] = useState({
                shopping: true,
                planner: true
            });
            // Budget states
            const [transactions, setTransactions] = useState([
                { id: 1, type: 'income', amount: 50000, category: 'Зарплата', date: '2024-01-15', description: 'Зарплата Ивана', balanceAfter: 50000 },
                { id: 2, type: 'expense', amount: 15000, category: 'Продукты', date: '2024-01-16', description: 'Покупка продуктов', balanceAfter: 35000 },
                { id: 3, type: 'expense', amount: 8000, category: 'Транспорт', date: '2024-01-17', description: 'Бензин', balanceAfter: 27000 },
                { id: 4, type: 'expense', amount: 5000, category: 'Продукты', date: '2024-01-18', description: 'Овощи и фрукты', balanceAfter: 22000 },
                { id: 5, type: 'expense', amount: 3000, category: 'Развлечения', date: '2024-01-19', description: 'Кино', balanceAfter: 19000 }
            ]);
            const [initialBalance, setInitialBalance] = useState(0);
            const [newTransaction, setNewTransaction] = useState({
                type: 'expense',
                amount: '',
                category: 'Продукты',
                date: new Date().toISOString().split('T')[0],
                description: ''
            });
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedDate, setSelectedDate] = useState(null);
            const [showAddTransaction, setShowAddTransaction] = useState(false);
            // Shopping list states
            const [shoppingList, setShoppingList] = useState([
                { id: 1, item: 'Молоко', quantity: 1, unit: 'литр', completed: false },
                { id: 2, item: 'Хлеб', quantity: 2, unit: 'штука', completed: true },
                { id: 3, item: 'Яблоки', quantity: 3, unit: 'килограмм', completed: false }
            ]);
            const [newItem, setNewItem] = useState({ name: '', quantity: '', unit: 'штука' });
            const [editingItemId, setEditingItemId] = useState(null);
            const [editingItemText, setEditingItemText] = useState('');
            const [editingItemQuantity, setEditingItemQuantity] = useState('');
            const [editingItemUnit, setEditingItemUnit] = useState('штука');
            const [showAddShoppingItem, setShowAddShoppingItem] = useState(false);
            // Calendar states
            const [calendarEvents, setCalendarEvents] = useState([
                {
                    id: 1,
                    title: 'Встреча с клиентом',
                    startDate: '2024-01-20',
                    startTime: '10:00',
                    endTime: '11:30',
                    color: 'bg-blue-500',
                    participants: ['Иван'],
                    isTemplate: false
                },
                {
                    id: 2,
                    title: 'Тренировка',
                    startDate: '2024-01-21',
                    startTime: '18:00',
                    endTime: '19:30',
                    color: 'bg-green-500',
                    participants: ['Мария'],
                    isTemplate: false
                }
            ]);
            const [newEvent, setNewEvent] = useState({
                title: '',
                startDate: new Date().toISOString().split('T')[0],
                startTime: '09:00',
                endTime: '',
                color: 'bg-blue-500',
                participants: [],
                isTemplate: false
            });
            const [editingEvent, setEditingEvent] = useState(null);
            const [showAddEventModal, setShowAddEventModal] = useState(false);
            const [showEditEventModal, setShowEditEventModal] = useState(false);
            const [showCreateTemplateModal, setShowCreateTemplateModal] = useState(false);
            const [currentDate, setCurrentDate] = useState(new Date());
            const [calendarView, setCalendarView] = useState('month');
            const [plannerCalendarView, setPlannerCalendarView] = useState('month'); // Separate view for planner
            // Settings
            const [savingsPercentage, setSavingsPercentage] = useState('');
            const [showBudgetSettings, setShowBudgetSettings] = useState(false);
            const [showShoppingSettings, setShowShoppingSettings] = useState(false);
            const [showPlannerSettings, setShowPlannerSettings] = useState(false);
            // Day settings
            const [dayStart, setDayStart] = useState('08:00');
            const [dayEnd, setDayEnd] = useState('20:00');
            // Participants
            const [participants, setParticipants] = useState([
                { name: 'Иван', color: 'bg-blue-500' },
                { name: 'Мария', color: 'bg-green-500' },
                { name: 'Алексей', color: 'bg-purple-500' }
            ]);
            const [newParticipant, setNewParticipant] = useState('');
            const [selectedParticipantColor, setSelectedParticipantColor] = useState('bg-blue-500');
            const [showAddParticipantModal, setShowAddParticipantModal] = useState(false);
            // Templates
            const [templates, setTemplates] = useState([
                { id: 1, name: 'Танцы' },
                { id: 2, name: 'Врач' },
                { id: 3, name: 'Тренировка' },
                { id: 4, name: 'Вокал' }
            ]);
            const [newTemplateName, setNewTemplateName] = useState('');
            // Shopping settings
            const [telegramBotToken, setTelegramBotToken] = useState('');
            const [telegramChatId, setTelegramChatId] = useState('');
            // File upload preview
            const [previewData, setPreviewData] = useState([]);
            const [showPreviewModal, setShowPreviewModal] = useState(false);
            // Fixed expenses
            const [fixedExpenses, setFixedExpenses] = useState([
                { id: 1, name: 'Аренда квартиры', amount: 15000, category: 'Жилье' },
                { id: 2, name: 'Интернет', amount: 500, category: 'Коммунальные услуги' },
                { id: 3, name: 'Электричество', amount: 1000, category: 'Коммунальные услуги' }
            ]);

            // Authentication handlers
            const handleLogin = async (email, password) => {
                setIsLoading(true);
                try {
                    const result = await firebase.auth().signInWithEmailAndPassword(email, password);
                    setUser(result.user);
                    return { success: true };
                } catch (error) {
                    console.error('Login error:', error.message);
                    return { success: false, error: error.message };
                } finally {
                    setIsLoading(false);
                }
            };

            const handleRegister = async (email, password) => {
                setIsLoading(true);
                try {
                    const result = await firebase.auth().createUserWithEmailAndPassword(email, password);
                    setUser(result.user);
                    return { success: true };
                } catch (error) {
                    console.error('Registration error:', error.message);
                    return { success: false, error: error.message };
                } finally {
                    setIsLoading(false);
                }
            };

            const handleLogout = () => {
                firebase.auth().signOut();
                setUser(null);
                setCurrentRoom(null);
            };

            // Budget functions
            const addTransaction = () => {
                if (!newTransaction.amount || !newTransaction.category) {
                    alert('Пожалуйста, заполните все обязательные поля');
                    return;
                }

                const amount = parseFloat(newTransaction.amount.replace(/[^0-9.]/g, ''));

                if (isNaN(amount) || amount <= 0) {
                    alert('Введите корректную сумму');
                    return;
                }

                const newId = transactions.length > 0 ? Math.max(...transactions.map(t => t.id)) + 1 : 1;

                // Calculate balance after transaction
                let lastBalance = initialBalance;
                if (transactions.length > 0) {
                    lastBalance = transactions[transactions.length - 1].balanceAfter || 0;
                }

                const balanceAfter = newTransaction.type === 'income'
                    ? lastBalance + amount
                    : lastBalance - amount;

                const transaction = {
                    id: newId,
                    ...newTransaction,
                    amount: amount,
                    balanceAfter: balanceAfter
                };

                setTransactions([...transactions, transaction]);

                // Reset form
                setNewTransaction({
                    type: 'expense',
                    amount: '',
                    category: 'Продукты',
                    date: new Date().toISOString().split('T')[0],
                    description: ''
                });

                setShowAddTransaction(false);
            };

            const deleteTransaction = (id) => {
                setTransactions(transactions.filter(t => t.id !== id));
            };

            const getBalance = () => {
                return transactions.reduce((sum, transaction) => {
                    return transaction.type === 'income'
                        ? sum + transaction.amount
                        : sum - transaction.amount;
                }, initialBalance);
            };

            const getFilteredTransactions = () => {
                let filtered = [...transactions];

                if (searchTerm) {
                    filtered = filtered.filter(t =>
                        t.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        t.category.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }

                if (selectedDate) {
                    filtered = filtered.filter(t => t.date === selectedDate);
                }

                if (!showAllTime) {
                    const today = new Date();
                    const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);

                    filtered = filtered.filter(t => {
                        const transactionDate = new Date(t.date);
                        return transactionDate >= thirtyDaysAgo && transactionDate <= today;
                    });
                }

                return filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
            };

            // Shopping list functions
            const addItem = () => {
                if (!newItem.name.trim()) {
                    alert('Пожалуйста, введите название товара');
                    return;
                }

                if (!newItem.quantity || isNaN(newItem.quantity) || parseInt(newItem.quantity) <= 0) {
                    alert('Пожалуйста, введите корректное количество');
                    return;
                }

                const newItemObj = {
                    id: shoppingList.length > 0 ? Math.max(...shoppingList.map(i => i.id)) + 1 : 1,
                    item: newItem.name,
                    quantity: parseInt(newItem.quantity),
                    unit: newItem.unit,
                    completed: false
                };

                setShoppingList([...shoppingList, newItemObj]);

                setNewItem({ name: '', quantity: '', unit: 'штука' });
                setShowAddShoppingItem(false);
            };

            const toggleItemCompletion = (id) => {
                setShoppingList(shoppingList.map(item =>
                    item.id === id ? { ...item, completed: !item.completed } : item
                ));
            };

            const deleteItem = (id) => {
                setShoppingList(shoppingList.filter(item => item.id !== id));
            };

            const updateItem = () => {
                if (!editingItemText.trim()) {
                    alert('Пожалуйста, введите название товара');
                    return;
                }

                if (!editingItemQuantity || isNaN(editingItemQuantity) || parseInt(editingItemQuantity) <= 0) {
                    alert('Пожалуйста, введите корректное количество');
                    return;
                }

                setShoppingList(shoppingList.map(item =>
                    item.id === editingItemId
                        ? {
                            ...item,
                            item: editingItemText,
                            quantity: parseInt(editingItemQuantity),
                            unit: editingItemUnit
                        }
                        : item
                ));

                setEditingItemId(null);
                setEditingItemText('');
                setEditingItemQuantity('');
                setEditingItemUnit('штука');
            };

            const startEditingItem = (item) => {
                setEditingItemId(item.id);
                setEditingItemText(item.item);
                setEditingItemQuantity(item.quantity.toString());
                setEditingItemUnit(item.unit);
            };

            const getCompletedItems = () => {
                return shoppingList.filter(item => item.completed);
            };

            const getPendingItems = () => {
                return shoppingList.filter(item => !item.completed);
            };

            // Calendar functions
            const addEvent = () => {
                if (!newEvent.title.trim()) {
                    alert('Пожалуйста, введите название события');
                    return;
                }

                if (!newEvent.endTime) {
                    alert('Пожалуйста, выберите время окончания');
                    return;
                }

                const event = {
                    id: calendarEvents.length > 0 ? Math.max(...calendarEvents.map(e => e.id)) + 1 : 1,
                    ...newEvent
                };

                setCalendarEvents([...calendarEvents, event]);

                setNewEvent({
                    title: '',
                    startDate: new Date().toISOString().split('T')[0],
                    startTime: '09:00',
                    endTime: '',
                    color: 'bg-blue-500',
                    participants: [],
                    isTemplate: false
                });

                setShowAddEventModal(false);
            };

            const deleteEvent = (id) => {
                setCalendarEvents(calendarEvents.filter(event => event.id !== id));
            };

            const updateEvent = () => {
                if (!editingEvent.title.trim()) {
                    alert('Пожалуйста, введите название события');
                    return;
                }

                if (!editingEvent.endTime) {
                    alert('Пожалуйста, выберите время окончания');
                    return;
                }

                setCalendarEvents(calendarEvents.map(event =>
                    event.id === editingEvent.id ? editingEvent : event
                ));

                setEditingEvent(null);
                setShowEditEventModal(false);
            };

            const getEventsForDate = (dateString) => {
                return calendarEvents.filter(event => event.startDate === dateString);
            };

            const navigateMonth = (direction) => {
                const newDate = new Date(currentDate);
                newDate.setMonth(currentDate.getMonth() + direction);
                setCurrentDate(newDate);
            };

            // Room functions
            const handleRoomAction = async () => {
                if (roomMode === 'create') {
                    if (!roomName.trim()) {
                        setRoomError('Пожалуйста, введите название комнаты');
                        return;
                    }

                    setIsLoading(true);
                    try {
                        // Generate random room ID
                        const roomId = Math.random().toString(36).substring(2, 10).toUpperCase();

                        // Save room data to Firebase
                        await db.ref(`rooms/${roomId}`).set({
                            name: roomName,
                            password: roomPassword,
                            createdAt: new Date().toISOString()
                        });

                        setCurrentRoom({ id: roomId, name: roomName });
                        setRoomSuccess('Комната создана успешно!');
                        setTimeout(() => {
                            setShowRoomModal(false);
                            setRoomSuccess('');
                        }, 2000);
                    } catch (error) {
                        setRoomError('Ошибка при создании комнаты: ' + error.message);
                    } finally {
                        setIsLoading(false);
                    }
                } else { // join mode
                    if (!roomId.trim()) {
                        setRoomError('Пожалуйста, введите ID комнаты');
                        return;
                    }

                    setIsLoading(true);
                    try {
                        const snapshot = await db.ref(`rooms/${roomId}`).once('value');
                        const roomData = snapshot.val();

                        if (!roomData) {
                            setRoomError('Комната не найдена');
                            return;
                        }

                        if (roomPassword && roomData.password !== roomPassword) {
                            setRoomError('Неверный пароль');
                            return;
                        }

                        setCurrentRoom({ id: roomId, name: roomData.name });
                        setRoomSuccess('Успешно подключились к комнате!');
                        setTimeout(() => {
                            setShowRoomModal(false);
                            setRoomSuccess('');
                        }, 2000);
                    } catch (error) {
                        setRoomError('Ошибка при подключении к комнате: ' + error.message);
                    } finally {
                        setIsLoading(false);
                    }
                }
            };

            // Settings functions
            const saveSettings = () => {
                // In a real app, this would save to Firebase or localStorage
                alert('Настройки сохранены!');
            };

            // Add participant
            const addParticipant = () => {
                if (!newParticipant.trim()) {
                    alert('Пожалуйста, введите имя участника');
                    return;
                }

                const existingParticipant = participants.find(p => p.name.toLowerCase() === newParticipant.trim().toLowerCase());
                if (existingParticipant) {
                    alert('Участник с таким именем уже существует');
                    return;
                }

                const newPart = {
                    name: newParticipant.trim(),
                    color: selectedParticipantColor
                };

                setParticipants([...participants, newPart]);
                setNewParticipant('');
                setSelectedParticipantColor('bg-blue-500');
                setShowAddParticipantModal(false);
            };

            // Add template
            const addTemplate = () => {
                if (!newTemplateName.trim()) {
                    alert('Пожалуйста, введите название шаблона');
                    return;
                }

                const newTemp = {
                    id: templates.length > 0 ? Math.max(...templates.map(t => t.id)) + 1 : 1,
                    name: newTemplateName.trim()
                };

                setTemplates([...templates, newTemp]);
                setNewTemplateName('');
            };

            // Apply template to create event
            const applyTemplate = (template) => {
                setNewEvent(prev => ({
                    ...prev,
                    title: template.name
                }));
            };

            // Get current month days for calendar
            const getCurrentMonthDays = () => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();

                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());

                const days = [];
                const current = new Date(startDate);

                for (let i = 0; i < 42; i++) { // 6 weeks
                    days.push(new Date(current));
                    current.setDate(current.getDate() + 1);
                }

                return days;
            };

            // Format date for display
            const formatDate = (date) => {
                return date.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
            };

            // Format time range for display
            const formatTimeRange = (startTime, endTime) => {
                return `${startTime} - ${endTime}`;
            };

            // Render the app
            if (showRoomModal) {
                return (
                    <div className="app-container">
                        <div className="auth-container">
                            <div className="auth-header">
                                <h1>Семейный Бюджет</h1>
                                <p>Присоединитесь или создайте комнату для совместного управления бюджетом</p>
                            </div>

                            <div className="mode-toggle">
                                <div className={`mode-toggle-slider ${roomMode === 'create' ? 'active' : ''}`} style={{
                                    left: roomMode === 'create' ? '0' : 'calc(50% + 2px)',
                                    width: 'calc(50% - 4px)'
                                }}></div>
                                <button
                                    className={`mode-toggle-btn ${roomMode === 'join' ? 'active' : ''}`}
                                    onClick={() => setRoomMode('join')}
                                >
                                    Присоединиться
                                </button>
                                <button
                                    className={`mode-toggle-btn ${roomMode === 'create' ? 'active' : ''}`}
                                    onClick={() => setRoomMode('create')}
                                >
                                    Создать комнату
                                </button>
                            </div>

                            {roomMode === 'join' ? (
                                <div>
                                    <div className="form-group">
                                        <label className="form-label">ID Комната</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={roomId}
                                            onChange={(e) => setRoomId(e.target.value.toUpperCase())}
                                            placeholder="Введите ID комнаты"
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Пароль (если есть)</label>
                                        <input
                                            type="password"
                                            className="form-input"
                                            value={roomPassword}
                                            onChange={(e) => setRoomPassword(e.target.value)}
                                            placeholder="Введите пароль"
                                        />
                                    </div>
                                </div>
                            ) : (
                                <div>
                                    <div className="form-group">
                                        <label className="form-label">Название комнаты</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={roomName}
                                            onChange={(e) => setRoomName(e.target.value)}
                                            placeholder="Введите название комнаты"
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Пароль (необязательно)</label>
                                        <input
                                            type="password"
                                            className="form-input"
                                            value={roomPassword}
                                            onChange={(e) => setRoomPassword(e.target.value)}
                                            placeholder="Введите пароль (оставьте пустым для открытия)"
                                        />
                                    </div>
                                </div>
                            )}

                            {roomError && (
                                <div className="error-message">
                                    <i className="fas fa-exclamation-circle"></i>
                                    {roomError}
                                </div>
                            )}

                            {roomSuccess && (
                                <div className="success-message">
                                    <i className="fas fa-check-circle"></i>
                                    {roomSuccess}
                                </div>
                            )}

                            <button
                                className="btn-auth"
                                onClick={handleRoomAction}
                                disabled={isLoading}
                            >
                                {isLoading ? (
                                    <span>
                                        <i className="fas fa-spinner fa-spin"></i> Обработка...
                                    </span>
                                ) : roomMode === 'join' ? (
                                    'Присоединиться'
                                ) : (
                                    'Создать комнату'
                                )}
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="app-container">
                    <header>
                        <div className="header-content">
                            <div className="logo">
                                <div className="logo-icon">
                                    <i className="fas fa-wallet"></i>
                                </div>
                                <span>Семейный Бюджет</span>
                            </div>

                            <nav>
                                <button
                                    className={`nav-button ${activeTab === 'budget' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('budget')}
                                >
                                    <i className="fas fa-chart-line"></i>
                                    Бюджет
                                </button>

                                {tabVisibility.shopping && (
                                    <button
                                        className={`nav-button ${activeTab === 'shopping' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('shopping')}
                                    >
                                        <i className="fas fa-shopping-cart"></i>
                                        Покупки
                                    </button>
                                )}

                                {tabVisibility.planner && (
                                    <button
                                        className={`nav-button ${activeTab === 'planner' ? 'active' : ''}`}
                                        onClick={() => setActiveTab('planner')}
                                    >
                                        <i className="fas fa-calendar-alt"></i>
                                        Планировщик
                                    </button>
                                )}

                                <button
                                    className={`nav-button ${activeTab === 'settings' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('settings')}
                                >
                                    <i className="fas fa-cog"></i>
                                    Настройки
                                </button>
                            </nav>

                            {currentRoom && (
                                <div className="room-info">
                                    <span className="text-sm text-white mr-2">Комната: {currentRoom.name}</span>
                                    <button
                                        className="btn-secondary"
                                        onClick={handleLogout}
                                    >
                                        Выйти
                                    </button>
                                </div>
                            )}
                        </div>
                    </header>

                    <main>
                        {activeTab === 'budget' && (
                            <BudgetTab
                                transactions={getFilteredTransactions()}
                                newTransaction={newTransaction}
                                setNewTransaction={setNewTransaction}
                                addTransaction={addTransaction}
                                deleteTransaction={deleteTransaction}
                                getBalance={getBalance}
                                searchTerm={searchTerm}
                                setSearchTerm={setSearchTerm}
                                selectedDate={selectedDate}
                                setSelectedDate={setSelectedDate}
                                showAllTime={showAllTime}
                                setShowAllTime={setShowAllTime}
                                showAddTransaction={showAddTransaction}
                                setShowAddTransaction={setShowAddTransaction}
                                initialBalance={initialBalance}
                                setInitialBalance={setInitialBalance}
                                showBudgetSettings={showBudgetSettings}
                                setShowBudgetSettings={setShowBudgetSettings}
                                fixedExpenses={fixedExpenses}
                                setFixedExpenses={setFixedExpenses}
                            />
                        )}

                        {activeTab === 'shopping' && (
                            <ShoppingTab
                                shoppingList={shoppingList}
                                newItem={newItem}
                                setNewItem={setNewItem}
                                addItem={addItem}
                                toggleItemCompletion={toggleItemCompletion}
                                deleteItem={deleteItem}
                                getCompletedItems={getCompletedItems}
                                getPendingItems={getPendingItems}
                                showAddShoppingItem={showAddShoppingItem}
                                setShowAddShoppingItem={setShowAddShoppingItem}
                                editingItemId={editingItemId}
                                editingItemText={editingItemText}
                                setEditingItemText={setEditingItemText}
                                editingItemQuantity={editingItemQuantity}
                                setEditingItemQuantity={setEditingItemQuantity}
                                editingItemUnit={editingItemUnit}
                                setEditingItemUnit={setEditingItemUnit}
                                startEditingItem={startEditingItem}
                                updateItem={updateItem}
                                showShoppingSettings={showShoppingSettings}
                                setShowShoppingSettings={setShowShoppingSettings}
                                telegramBotToken={telegramBotToken}
                                setTelegramBotToken={setTelegramBotToken}
                                telegramChatId={telegramChatId}
                                setTelegramChatId={setTelegramChatId}
                                previewData={previewData}
                                setPreviewData={setPreviewData}
                                showPreviewModal={showPreviewModal}
                                setShowPreviewModal={setShowPreviewModal}
                            />
                        )}

                        {activeTab === 'planner' && (
                            <PlannerTab
                                calendarEvents={calendarEvents}
                                newEvent={newEvent}
                                setNewEvent={setNewEvent}
                                addEvent={addEvent}
                                deleteEvent={deleteEvent}
                                getEventsForDate={getEventsForDate}
                                currentDate={currentDate}
                                navigateMonth={navigateMonth}
                                calendarView={plannerCalendarView}
                                setCalendarView={setPlannerCalendarView}
                                showAddEventModal={showAddEventModal}
                                setShowAddEventModal={setShowAddEventModal}
                                editingEvent={editingEvent}
                                setEditingEvent={setEditingEvent}
                                showEditEventModal={showEditEventModal}
                                setShowEditEventModal={setShowEditEventModal}
                                showCreateTemplateModal={showCreateTemplateModal}
                                setShowCreateTemplateModal={setShowCreateTemplateModal}
                                templates={templates}
                                addTemplate={addTemplate}
                                newTemplateName={newTemplateName}
                                setNewTemplateName={setNewTemplateName}
                                applyTemplate={applyTemplate}
                                participants={participants}
                                showPlannerSettings={showPlannerSettings}
                                setShowPlannerSettings={setShowPlannerSettings}
                                dayStart={dayStart}
                                dayEnd={dayEnd}
                                setDayStart={setDayStart}
                                setDayEnd={setDayEnd}
                                showAddParticipantModal={showAddParticipantModal}
                                setShowAddParticipantModal={setShowAddParticipantModal}
                                newParticipant={newParticipant}
                                setNewParticipant={setNewParticipant}
                                selectedParticipantColor={selectedParticipantColor}
                                setSelectedParticipantColor={setSelectedParticipantColor}
                                addParticipant={addParticipant}
                            />
                        )}

                        {activeTab === 'settings' && (
                            <SettingsTab
                                tabVisibility={tabVisibility}
                                setTabVisibility={setTabVisibility}
                                savingsPercentage={savingsPercentage}
                                setSavingsPercentage={setSavingsPercentage}
                                showBudgetSettings={showBudgetSettings}
                                setShowBudgetSettings={setShowBudgetSettings}
                                showShoppingSettings={showShoppingSettings}
                                setShowShoppingSettings={setShowShoppingSettings}
                                showPlannerSettings={showPlannerSettings}
                                setShowPlannerSettings={setShowPlannerSettings}
                                saveSettings={saveSettings}
                                user={user}
                                handleLogout={handleLogout}
                            />
                        )}
                    </main>
                </div>
            );
        };

        // Budget Tab Component
        const BudgetTab = ({
            transactions, newTransaction, setNewTransaction, addTransaction, deleteTransaction,
            getBalance, searchTerm, setSearchTerm, selectedDate, setSelectedDate, showAllTime,
            setShowAllTime, showAddTransaction, setShowAddTransaction, initialBalance, setInitialBalance,
            showBudgetSettings, setShowBudgetSettings, fixedExpenses, setFixedExpenses
        }) => {
            const [showFixedExpenses, setShowFixedExpenses] = useState(false);

            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);

            const totalExpenses = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            return (
                <div>
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div className="card bg-purple-50 border border-purple-100">
                            <div className="text-gray-600 text-sm">Баланс</div>
                            <div className="text-2xl font-bold text-purple-600">{getBalance().toLocaleString()} ₽</div>
                        </div>
                        <div className="card bg-green-50 border border-green-100">
                            <div className="text-gray-600 text-sm">Доходы</div>
                            <div className="text-2xl font-bold text-green-600">{totalIncome.toLocaleString()} ₽</div>
                        </div>
                        <div className="card bg-red-50 border border-red-100">
                            <div className="text-gray-600 text-sm">Расходы</div>
                            <div className="text-2xl font-bold text-red-600">{totalExpenses.toLocaleString()} ₽</div>
                        </div>
                        <div className="card bg-blue-50 border border-blue-100">
                            <div className="text-gray-600 text-sm">Разница</div>
                            <div className="text-2xl font-bold text-blue-600">{(totalIncome - totalExpenses).toLocaleString()} ₽</div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2">
                            <div className="card">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-semibold">Транзакции</h2>
                                    <div className="flex gap-2">
                                        <button
                                            className="btn-secondary"
                                            onClick={() => setShowAddTransaction(!showAddTransaction)}
                                        >
                                            <i className="fas fa-plus"></i> Добавить
                                        </button>
                                        <button
                                            className="btn-secondary"
                                            onClick={() => setShowBudgetSettings(!showBudgetSettings)}
                                        >
                                            <i className="fas fa-cog"></i>
                                        </button>
                                    </div>
                                </div>

                                {showAddTransaction && (
                                    <div className="mb-6 p-4 bg-gray-50 rounded-lg">
                                        <h3 className="font-semibold mb-3">Добавить транзакцию</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Тип</label>
                                                <select
                                                    value={newTransaction.type}
                                                    onChange={(e) => setNewTransaction({...newTransaction, type: e.target.value})}
                                                    className="w-full p-2 border rounded"
                                                >
                                                    <option value="income">Доход</option>
                                                    <option value="expense">Расход</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Сумма</label>
                                                <input
                                                    type="number"
                                                    value={newTransaction.amount}
                                                    onChange={(e) => setNewTransaction({...newTransaction, amount: e.target.value})}
                                                    className="w-full p-2 border rounded"
                                                    placeholder="Введите сумму"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Категория</label>
                                                <select
                                                    value={newTransaction.category}
                                                    onChange={(e) => setNewTransaction({...newTransaction, category: e.target.value})}
                                                    className="w-full p-2 border rounded"
                                                >
                                                    <option value="Продукты">Продукты</option>
                                                    <option value="Транспорт">Транспорт</option>
                                                    <option value="Развлечения">Развлечения</option>
                                                    <option value="Жилье">Жилье</option>
                                                    <option value="Здоровье">Здоровье</option>
                                                    <option value="Образование">Образование</option>
                                                    <option value="Зарплата">Зарплата</option>
                                                    <option value="Другое">Другое</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Дата</label>
                                                <input
                                                    type="date"
                                                    value={newTransaction.date}
                                                    onChange={(e) => setNewTransaction({...newTransaction, date: e.target.value})}
                                                    className="w-full p-2 border rounded"
                                                />
                                            </div>
                                            <div className="md:col-span-2">
                                                <label className="block text-sm font-medium mb-1">Описание</label>
                                                <input
                                                    type="text"
                                                    value={newTransaction.description}
                                                    onChange={(e) => setNewTransaction({...newTransaction, description: e.target.value})}
                                                    className="w-full p-2 border rounded"
                                                    placeholder="Введите описание"
                                                />
                                            </div>
                                        </div>
                                        <div className="flex gap-2 mt-3">
                                            <button
                                                className="btn-primary"
                                                onClick={addTransaction}
                                            >
                                                Сохранить
                                            </button>
                                            <button
                                                className="btn-secondary"
                                                onClick={() => setShowAddTransaction(false)}
                                            >
                                                Отмена
                                            </button>
                                        </div>
                                    </div>
                                )}

                                <div className="flex flex-wrap gap-4 mb-4">
                                    <input
                                        type="text"
                                        placeholder="Поиск по описанию или категории..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="p-2 border rounded w-full sm:w-64"
                                    />
                                    <input
                                        type="date"
                                        value={selectedDate || ''}
                                        onChange={(e) => setSelectedDate(e.target.value)}
                                        className="p-2 border rounded"
                                    />
                                    <button
                                        className={`px-4 py-2 rounded ${showAllTime ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                                        onClick={() => setShowAllTime(!showAllTime)}
                                    >
                                        {showAllTime ? '30 дней' : 'Все время'}
                                    </button>
                                    {selectedDate && (
                                        <button
                                            className="px-4 py-2 bg-gray-200 rounded"
                                            onClick={() => setSelectedDate(null)}
                                        >
                                            Сброс
                                        </button>
                                    )}
                                </div>

                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead>
                                            <tr className="border-b">
                                                <th className="text-left py-2">Дата</th>
                                                <th className="text-left py-2">Категория</th>
                                                <th className="text-left py-2">Описание</th>
                                                <th className="text-right py-2">Сумма</th>
                                                <th className="text-right py-2">Баланс</th>
                                                <th className="text-center py-2">Действия</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {transactions.map(transaction => (
                                                <tr key={transaction.id} className="border-b hover:bg-gray-50">
                                                    <td className="py-2">{transaction.date}</td>
                                                    <td className="py-2">
                                                        <span className={`px-2 py-1 rounded-full text-xs ${
                                                            transaction.type === 'income'
                                                                ? 'bg-green-100 text-green-800'
                                                                : 'bg-red-100 text-red-800'
                                                        }`}>
                                                            {transaction.category}
                                                        </span>
                                                    </td>
                                                    <td className="py-2">{transaction.description}</td>
                                                    <td className={`py-2 text-right font-medium ${
                                                        transaction.type === 'income' ? 'text-green-600' : 'text-red-600'
                                                    }`}>
                                                        {transaction.type === 'income' ? '+' : '-'}{transaction.amount.toLocaleString()} ₽
                                                    </td>
                                                    <td className="py-2 text-right text-gray-600">{transaction.balanceAfter?.toLocaleString()} ₽</td>
                                                    <td className="py-2 text-center">
                                                        <button
                                                            className="text-red-500 hover:text-red-700"
                                                            onClick={() => deleteTransaction(transaction.id)}
                                                        >
                                                            <i className="fas fa-trash"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div className="space-y-6">
                            <div className="card">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="font-semibold">Начальный баланс</h3>
                                </div>
                                <div className="flex items-center gap-2">
                                    <input
                                        type="number"
                                        value={initialBalance}
                                        onChange={(e) => setInitialBalance(Number(e.target.value))}
                                        className="flex-1 p-2 border rounded"
                                        placeholder="Начальный баланс"
                                    />
                                    <span>₽</span>
                                </div>
                            </div>

                            <div className="card">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="font-semibold">Фиксированные расходы</h3>
                                    <button
                                        className="text-sm btn-secondary"
                                        onClick={() => setShowFixedExpenses(!showFixedExpenses)}
                                    >
                                        {showFixedExpenses ? 'Скрыть' : 'Показать'}
                                    </button>
                                </div>

                                {showFixedExpenses && (
                                    <div className="space-y-3">
                                        {fixedExpenses.map(expense => (
                                            <div key={expense.id} className="flex justify-between items-center p-2 border-b">
                                                <div>
                                                    <div className="font-medium">{expense.name}</div>
                                                    <div className="text-sm text-gray-600">{expense.category}</div>
                                                </div>
                                                <div className="font-medium text-red-600">{expense.amount.toLocaleString()} ₽</div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Shopping Tab Component
        const ShoppingTab = ({
            shoppingList, newItem, setNewItem, addItem, toggleItemCompletion, deleteItem,
            getCompletedItems, getPendingItems, showAddShoppingItem, setShowAddShoppingItem,
            editingItemId, editingItemText, setEditingItemText, editingItemQuantity,
            setEditingItemQuantity, editingItemUnit, setEditingItemUnit, startEditingItem,
            updateItem, showShoppingSettings, setShowShoppingSettings, telegramBotToken,
            setTelegramBotToken, telegramChatId, setTelegramChatId, previewData, setPreviewData,
            showPreviewModal, setShowPreviewModal
        }) => {
            const pendingItems = getPendingItems();
            const completedItems = getCompletedItems();

            return (
                <div>
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <div className="card">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-semibold">Список покупок</h2>
                                    <div className="flex gap-2">
                                        <button
                                            className="btn-secondary"
                                            onClick={() => setShowAddShoppingItem(!showAddShoppingItem)}
                                        >
                                            <i className="fas fa-plus"></i> Добавить
                                        </button>
                                        <button
                                            className="btn-secondary"
                                            onClick={() => setShowShoppingSettings(!showShoppingSettings)}
                                        >
                                            <i className="fas fa-cog"></i>
                                        </button>
                                    </div>
                                </div>

                                {showAddShoppingItem && (
                                    <div className="mb-6 p-4 bg-gray-50 rounded-lg">
                                        <h3 className="font-semibold mb-3">Добавить товар</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Название</label>
                                                <input
                                                    type="text"
                                                    value={newItem.name}
                                                    onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                                                    className="w-full p-2 border rounded"
                                                    placeholder="Название товара"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Количество</label>
                                                <input
                                                    type="number"
                                                    value={newItem.quantity}
                                                    onChange={(e) => setNewItem({...newItem, quantity: e.target.value})}
                                                    className="w-full p-2 border rounded"
                                                    placeholder="Количество"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-1">Единица измерения</label>
                                                <select
                                                    value={newItem.unit}
                                                    onChange={(e) => setNewItem({...newItem, unit: e.target.value})}
                                                    className="w-full p-2 border rounded"
                                                >
                                                    <option value="штука">штука</option>
                                                    <option value="килограмм">килограмм</option>
                                                    <option value="грамм">грамм</option>
                                                    <option value="литр">литр</option>
                                                    <option value="метр">метр</option>
                                                    <option value="упаковка">упаковка</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div className="flex gap-2 mt-3">
                                            <button
                                                className="btn-primary"
                                                onClick={addItem}
                                            >
                                                Добавить
                                            </button>
                                            <button
                                                className="btn-secondary"
                                                onClick={() => setShowAddShoppingItem(false)}
                                            >
                                                Отмена
                                            </button>
                                        </div>
                                    </div>
                                )}

                                <div className="shopping-list-grid">
                                    <div>
                                        <h3 className="font-semibold mb-3 text-green-600">Нужно купить</h3>
                                        {pendingItems.length === 0 ? (
                                            <div className="text-center text-gray-500 py-4">Список пуст</div>
                                        ) : (
                                            pendingItems.map(item => (
                                                <div key={item.id} className="shopping-item">
                                                    <div className="shopping-item-content">
                                                        <div
                                                            className={`shopping-item-checkbox ${item.completed ? 'checked' : ''}`}
                                                            onClick={() => toggleItemCompletion(item.id)}
                                                        >
                                                            {item.completed && <i className="fas fa-check"></i>}
                                                        </div>
                                                        {editingItemId === item.id ? (
                                                            <div className="flex gap-2 flex-1">
                                                                <input
                                                                    type="text"
                                                                    value={editingItemText}
                                                                    onChange={(e) => setEditingItemText(e.target.value)}
                                                                    className="shopping-item-input"
                                                                />
                                                                <input
                                                                    type="number"
                                                                    value={editingItemQuantity}
                                                                    onChange={(e) => setEditingItemQuantity(e.target.value)}
                                                                    className="shopping-item-input w-20"
                                                                />
                                                                <select
                                                                    value={editingItemUnit}
                                                                    onChange={(e) => setEditingItemUnit(e.target.value)}
                                                                    className="shopping-item-input w-24"
                                                                >
                                                                    <option value="штука">шт</option>
                                                                    <option value="килограмм">кг</option>
                                                                    <option value="грамм">г</option>
                                                                    <option value="литр">л</option>
                                                                    <option value="метр">м</option>
                                                                    <option value="упаковка">уп</option>
                                                                </select>
                                                            </div>
                                                        ) : (
                                                            <div className="shopping-item-text">
                                                                {item.item} - {item.quantity} {item.unit}
                                                            </div>
                                                        )}
                                                    </div>
                                                    <div className="shopping-item-actions">
                                                        {editingItemId === item.id ? (
                                                            <>
                                                                <button
                                                                    className="shopping-item-edit"
                                                                    onClick={updateItem}
                                                                >
                                                                    <i className="fas fa-check"></i>
                                                                </button>
                                                                <button
                                                                    className="shopping-item-delete"
                                                                    onClick={() => {
                                                                        setEditingItemId(null);
                                                                        setEditingItemText('');
                                                                        setEditingItemQuantity('');
                                                                        setEditingItemUnit('штука');
                                                                    }}
                                                                >
                                                                    <i className="fas fa-times"></i>
                                                                </button>
                                                            </>
                                                        ) : (
                                                            <>
                                                                <button
                                                                    className="shopping-item-edit"
                                                                    onClick={() => startEditingItem(item)}
                                                                >
                                                                    <i className="fas fa-edit"></i>
                                                                </button>
                                                                <button
                                                                    className="shopping-item-delete"
                                                                    onClick={() => deleteItem(item.id)}
                                                                >
                                                                    <i className="fas fa-trash"></i>
                                                                </button>
                                                            </>
                                                        )}
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>

                                    <div>
                                        <h3 className="font-semibold mb-3 text-gray-600">Куплено</h3>
                                        {completedItems.length === 0 ? (
                                            <div className="text-center text-gray-500 py-4">Пока ничего не куплено</div>
                                        ) : (
                                            completedItems.map(item => (
                                                <div key={item.id} className="shopping-item">
                                                    <div className="shopping-item-content">
                                                        <div
                                                            className={`shopping-item-checkbox checked`}
                                                            onClick={() => toggleItemCompletion(item.id)}
                                                        >
                                                            <i className="fas fa-check"></i>
                                                        </div>
                                                        <div className="shopping-item-text completed">
                                                            {item.item} - {item.quantity} {item.unit}
                                                        </div>
                                                    </div>
                                                    <div className="shopping-item-actions">
                                                        <button
                                                            className="shopping-item-delete"
                                                            onClick={() => deleteItem(item.id)}
                                                        >
                                                            <i className="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div className="card">
                                <h3 className="font-semibold mb-4">Настройки покупок</h3>

                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Telegram Bot Token</label>
                                        <input
                                            type="text"
                                            value={telegramBotToken}
                                            onChange={(e) => setTelegramBotToken(e.target.value)}
                                            className="w-full p-2 border rounded"
                                            placeholder="Введите токен бота"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium mb-2">Telegram Chat ID</label>
                                        <input
                                            type="text"
                                            value={telegramChatId}
                                            onChange={(e) => setTelegramChatId(e.target.value)}
                                            className="w-full p-2 border rounded"
                                            placeholder="Введите ID чата"
                                        />
                                    </div>

                                    <button className="btn-primary w-full">
                                        <i className="fas fa-paper-plane mr-2"></i>
                                        Отправить список в Telegram
                                    </button>

                                    <div className="border-t pt-4">
                                        <h4 className="font-medium mb-3">Импорт списка покупок</h4>
                                        <div className="file-upload">
                                            <input type="file" id="csv-upload" accept=".csv" />
                                            <label htmlFor="csv-upload">
                                                <i className="fas fa-cloud-upload-alt"></i>
                                                <p>Нажмите для загрузки CSV файла</p>
                                                <p className="text-sm text-gray-500">или перетащите файл сюда</p>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Planner Tab Component
        const PlannerTab = ({
            calendarEvents, newEvent, setNewEvent, addEvent, deleteEvent, getEventsForDate,
            currentDate, navigateMonth, calendarView, setCalendarView, showAddEventModal,
            setShowAddEventModal, editingEvent, setEditingEvent, showEditEventModal,
            setShowEditEventModal, showCreateTemplateModal, setShowCreateTemplateModal,
            templates, addTemplate, newTemplateName, setNewTemplateName, applyTemplate,
            participants, showPlannerSettings, setShowPlannerSettings, dayStart, dayEnd,
            setDayStart, setDayEnd, showAddParticipantModal, setShowAddParticipantModal,
            newParticipant, setNewParticipant, selectedParticipantColor, setSelectedParticipantColor,
            addParticipant
        }) => {
            const monthNames = [
                'Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь',
                'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'
            ];

            const dayNames = ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'];

            const eventsByDate = calendarEvents.reduce((acc, event) => {
                if (!acc[event.startDate]) {
                    acc[event.startDate] = [];
                }
                acc[event.startDate].push(event);
                return acc;
            }, {});

            const renderMonthView = () => {
                const days = getCurrentMonthDays();

                return (
                    <div>
                        <div className="calendar-grid">
                            {dayNames.map(day => (
                                <div key={day} className="calendar-header-cell">{day}</div>
                            ))}
                            {days.map((day, index) => {
                                const dateString = day.toISOString().split('T')[0];
                                const isCurrentMonth = day.getMonth() === currentDate.getMonth();
                                const isToday = day.toDateString() === new Date().toDateString();
                                const dayEvents = eventsByDate[dateString] || [];

                                return (
                                    <div
                                        key={index}
                                        className={`calendar-day-cell ${!isCurrentMonth ? 'other-month' : ''} ${isToday ? 'selected-day' : ''}`}
                                    >
                                        <div className="calendar-day-number">{day.getDate()}</div>
                                        <div className="calendar-events-container">
                                            {dayEvents.slice(0, 3).map(event => (
                                                <div
                                                    key={event.id}
                                                    className={`calendar-event-item ${event.color}`}
                                                    onClick={() => {
                                                        setEditingEvent(event);
                                                        setShowEditEventModal(true);
                                                    }}
                                                >
                                                    {event.title}
                                                </div>
                                            ))}
                                            {dayEvents.length > 3 && (
                                                <div className="text-xs text-gray-500">+{dayEvents.length - 3} еще</div>
                                            )}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            const getCurrentMonthDays = () => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();

                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());

                const days = [];
                const current = new Date(startDate);

                for (let i = 0; i < 42; i++) { // 6 weeks
                    days.push(new Date(current));
                    current.setDate(current.getDate() + 1);
                }

                return days;
            };

            return (
                <div>
                    <div className="card">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-xl font-semibold">Планировщик</h2>
                            <div className="flex gap-2">
                                <button
                                    className="btn-secondary"
                                    onClick={() => setShowAddEventModal(true)}
                                >
                                    <i className="fas fa-plus"></i> Добавить событие
                                </button>
                                <button
                                    className="btn-secondary"
                                    onClick={() => setShowPlannerSettings(!showPlannerSettings)}
                                >
                                    <i className="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>

                        <div className="calendar-navigation">
                            <button
                                className="calendar-nav-button"
                                onClick={() => navigateMonth(-1)}
                            >
                                <i className="fas fa-chevron-left"></i>
                            </button>
                            <h3 className="calendar-title">
                                {monthNames[currentDate.getMonth()]} {currentDate.getFullYear()}
                            </h3>
                            <button
                                className="calendar-nav-button"
                                onClick={() => navigateMonth(1)}
                            >
                                <i className="fas fa-chevron-right"></i>
                            </button>
                            <button
                                className="calendar-today-button"
                                onClick={() => setCurrentDate(new Date())}
                            >
                                Сегодня
                            </button>
                        </div>

                        {renderMonthView()}
                    </div>

                    {/* Add Event Modal */}
                    {showAddEventModal && (
                        <div className="modal-overlay">
                            <div className="modal-content">
                                <div className="modal-header">
                                    <h3 className="modal-title">Добавить событие</h3>
                                    <button
                                        className="modal-close"
                                        onClick={() => setShowAddEventModal(false)}
                                    >
                                        <i className="fas fa-times"></i>
                                    </button>
                                </div>
                                <div className="modal-body">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="md:col-span-2">
                                            <label className="block text-sm font-medium mb-1">Название события</label>
                                            <input
                                                type="text"
                                                value={newEvent.title}
                                                onChange={(e) => setNewEvent({...newEvent, title: e.target.value})}
                                                className="w-full p-2 border rounded"
                                                placeholder="Введите название"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium mb-1">Дата</label>
                                            <input
                                                type="date"
                                                value={newEvent.startDate}
                                                onChange={(e) => setNewEvent({...newEvent, startDate: e.target.value})}
                                                className="w-full p-2 border rounded"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium mb-1">Время начала</label>
                                            <input
                                                type="time"
                                                value={newEvent.startTime}
                                                onChange={(e) => setNewEvent({...newEvent, startTime: e.target.value})}
                                                className="w-full p-2 border rounded"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium mb-1">Время окончания</label>
                                            <input
                                                type="time"
                                                value={newEvent.endTime}
                                                onChange={(e) => setNewEvent({...newEvent, endTime: e.target.value})}
                                                className="w-full p-2 border rounded"
                                            />
                                        </div>

                                        <div className="md:col-span-2">
                                            <label className="block text-sm font-medium mb-1">Цвет</label>
                                            <div className="color-picker">
                                                {['bg-blue-500', 'bg-green-500', 'bg-red-500', 'bg-yellow-500', 'bg-purple-500', 'bg-pink-500', 'bg-indigo-500', 'bg-teal-500'].map(color => (
                                                    <div
                                                        key={color}
                                                        className={`color-option ${newEvent.color === color ? 'selected' : ''} ${color}`}
                                                        onClick={() => setNewEvent({...newEvent, color: color})}
                                                    ></div>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="md:col-span-2">
                                            <label className="block text-sm font-medium mb-1">Участники</label>
                                            <div className="participant-chips">
                                                {participants.map(participant => (
                                                    <div
                                                        key={participant.name}
                                                        className={`participant-chip ${newEvent.participants.includes(participant.name) ? 'selected' : ''}`}
                                                        onClick={() => {
                                                            if (newEvent.participants.includes(participant.name)) {
                                                                setNewEvent({
                                                                    ...newEvent,
                                                                    participants: newEvent.participants.filter(p => p !== participant.name)
                                                                });
                                                            } else {
                                                                setNewEvent({
                                                                    ...newEvent,
                                                                    participants: [...newEvent.participants, participant.name]
                                                                });
                                                            }
                                                        }}
                                                    >
                                                        <span>{participant.name}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>

                                    <div className="mt-4">
                                        <h4 className="font-medium mb-2">Шаблоны</h4>
                                        <div className="flex flex-wrap gap-2">
                                            {templates.map(template => (
                                                <span
                                                    key={template.id}
                                                    className="template-chip"
                                                    onClick={() => applyTemplate(template)}
                                                >
                                                    {template.name}
                                                </span>
                                            ))}
                                            <button
                                                className="btn-secondary text-sm"
                                                onClick={() => setShowCreateTemplateModal(true)}
                                            >
                                                <i className="fas fa-plus"></i> Новый шаблон
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div className="modal-footer">
                                    <button
                                        className="btn-secondary"
                                        onClick={() => setShowAddEventModal(false)}
                                    >
                                        Отмена
                                    </button>
                                    <button
                                        className="btn-primary"
                                        onClick={addEvent}
                                    >
                                        Сохранить
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Edit Event Modal */}
                    {showEditEventModal && editingEvent && (
                        <div className="modal-overlay">
                            <div className="modal-content">
                                <div className="modal-header">
                                    <h3 className="modal-title">Редактировать событие</h3>
                                    <button
                                        className="modal-close"
                                        onClick={() => {
                                            setShowEditEventModal(false);
                                            setEditingEvent(null);
                                        }}
                                    >
                                        <i className="fas fa-times"></i>
                                    </button>
                                </div>
                                <div className="modal-body">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="md:col-span-2">
                                            <label className="block text-sm font-medium mb-1">Название события</label>
                                            <input
                                                type="text"
                                                value={editingEvent.title}
                                                onChange={(e) => setEditingEvent({...editingEvent, title: e.target.value})}
                                                className="w-full p-2 border rounded"
                                                placeholder="Введите название"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium mb-1">Дата</label>
                                            <input
                                                type="date"
                                                value={editingEvent.startDate}
                                                onChange={(e) => setEditingEvent({...editingEvent, startDate: e.target.value})}
                                                className="w-full p-2 border rounded"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium mb-1">Время начала</label>
                                            <input
                                                type="time"
                                                value={editingEvent.startTime}
                                                onChange={(e) => setEditingEvent({...editingEvent, startTime: e.target.value})}
                                                className="w-full p-2 border rounded"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium mb-1">Время окончания</label>
                                            <input
                                                type="time"
                                                value={editingEvent.endTime}
                                                onChange={(e) => setEditingEvent({...editingEvent, endTime: e.target.value})}
                                                className="w-full p-2 border rounded"
                                            />
                                        </div>

                                        <div className="md:col-span-2">
                                            <label className="block text-sm font-medium mb-1">Цвет</label>
                                            <div className="color-picker">
                                                {['bg-blue-500', 'bg-green-500', 'bg-red-500', 'bg-yellow-500', 'bg-purple-500', 'bg-pink-500', 'bg-indigo-500', 'bg-teal-500'].map(color => (
                                                    <div
                                                        key={color}
                                                        className={`color-option ${editingEvent.color === color ? 'selected' : ''} ${color}`}
                                                        onClick={() => setEditingEvent({...editingEvent, color: color})}
                                                    ></div>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="md:col-span-2">
                                            <label className="block text-sm font-medium mb-1">Участники</label>
                                            <div className="participant-chips">
                                                {participants.map(participant => (
                                                    <div
                                                        key={participant.name}
                                                        className={`participant-chip ${editingEvent.participants.includes(participant.name) ? 'selected' : ''}`}
                                                        onClick={() => {
                                                            if (editingEvent.participants.includes(participant.name)) {
                                                                setEditingEvent({
                                                                    ...editingEvent,
                                                                    participants: editingEvent.participants.filter(p => p !== participant.name)
                                                                });
                                                            } else {
                                                                setEditingEvent({
                                                                    ...editingEvent,
                                                                    participants: [...editingEvent.participants, participant.name]
                                                                });
                                                            }
                                                        }}
                                                    >
                                                        <span>{participant.name}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div className="modal-footer">
                                    <button
                                        className="btn-danger"
                                        onClick={() => {
                                            deleteEvent(editingEvent.id);
                                            setShowEditEventModal(false);
                                            setEditingEvent(null);
                                        }}
                                    >
                                        Удалить
                                    </button>
                                    <button
                                        className="btn-secondary"
                                        onClick={() => {
                                            setShowEditEventModal(false);
                                            setEditingEvent(null);
                                        }}
                                    >
                                        Отмена
                                    </button>
                                    <button
                                        className="btn-primary"
                                        onClick={() => {
                                            updateEvent();
                                            setShowEditEventModal(false);
                                        }}
                                    >
                                        Сохранить
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Create Template Modal */}
                    {showCreateTemplateModal && (
                        <div className="modal-overlay">
                            <div className="modal-content">
                                <div className="modal-header">
                                    <h3 className="modal-title">Создать шаблон</h3>
                                    <button
                                        className="modal-close"
                                        onClick={() => setShowCreateTemplateModal(false)}
                                    >
                                        <i className="fas fa-times"></i>
                                    </button>
                                </div>
                                <div className="modal-body">
                                    <div className="form-group">
                                        <label className="form-label">Название шаблона</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={newTemplateName}
                                            onChange={(e) => setNewTemplateName(e.target.value)}
                                            placeholder="Введите название шаблона"
                                        />
                                    </div>
                                </div>
                                <div className="modal-footer">
                                    <button
                                        className="btn-secondary"
                                        onClick={() => setShowCreateTemplateModal(false)}
                                    >
                                        Отмена
                                    </button>
                                    <button
                                        className="btn-primary"
                                        onClick={() => {
                                            addTemplate();
                                            setShowCreateTemplateModal(false);
                                            setNewTemplateName('');
                                        }}
                                    >
                                        Создать
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Add Participant Modal */}
                    {showAddParticipantModal && (
                        <div className="modal-overlay">
                            <div className="modal-content">
                                <div className="modal-header">
                                    <h3 className="modal-title">Добавить участника</h3>
                                    <button
                                        className="modal-close"
                                        onClick={() => setShowAddParticipantModal(false)}
                                    >
                                        <i className="fas fa-times"></i>
                                    </button>
                                </div>
                                <div className="modal-body">
                                    <div className="grid grid-cols-1 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Имя участника</label>
                                            <input
                                                type="text"
                                                value={newParticipant}
                                                onChange={(e) => setNewParticipant(e.target.value)}
                                                className="w-full p-2 border rounded"
                                                placeholder="Введите имя участника"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium mb-1">Цвет</label>
                                            <div className="color-picker">
                                                {['bg-blue-500', 'bg-green-500', 'bg-red-500', 'bg-yellow-500', 'bg-purple-500', 'bg-pink-500', 'bg-indigo-500', 'bg-teal-500'].map(color => (
                                                    <div
                                                        key={color}
                                                        className={`color-option ${selectedParticipantColor === color ? 'selected' : ''} ${color}`}
                                                        onClick={() => setSelectedParticipantColor(color)}
                                                    ></div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div className="modal-footer">
                                    <button
                                        className="btn-secondary"
                                        onClick={() => setShowAddParticipantModal(false)}
                                    >
                                        Отмена
                                    </button>
                                    <button
                                        className="btn-primary"
                                        onClick={addParticipant}
                                    >
                                        Добавить
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Settings Tab Component
        const SettingsTab = ({
            tabVisibility, setTabVisibility, savingsPercentage, setSavingsPercentage,
            showBudgetSettings, setShowBudgetSettings, showShoppingSettings, setShowShoppingSettings,
            showPlannerSettings, setShowPlannerSettings, saveSettings, user, handleLogout
        }) => {
            return (
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div className="card">
                        <h3 className="font-semibold mb-4">Видимость вкладок</h3>

                        <div className="space-y-3">
                            <div className="flex items-center justify-between">
                                <span>Покупки</span>
                                <label className="toggle-switch">
                                    <input
                                        type="checkbox"
                                        checked={tabVisibility.shopping}
                                        onChange={(e) => setTabVisibility({
                                            ...tabVisibility,
                                            shopping: e.target.checked
                                        })}
                                    />
                                    <span className="slider"></span>
                                </label>
                            </div>

                            <div className="flex items-center justify-between">
                                <span>Планировщик</span>
                                <label className="toggle-switch">
                                    <input
                                        type="checkbox"
                                        checked={tabVisibility.planner}
                                        onChange={(e) => setTabVisibility({
                                            ...tabVisibility,
                                            planner: e.target.checked
                                        })}
                                    />
                                    <span className="slider"></span>
                                </label>
                            </div>
                        </div>

                        <div className="mt-6">
                            <label className="block text-sm font-medium mb-2">Процент сбережений</label>
                            <div className="flex items-center gap-2">
                                <input
                                    type="number"
                                    value={savingsPercentage}
                                    onChange={(e) => setSavingsPercentage(e.target.value)}
                                    className="flex-1 p-2 border rounded"
                                    placeholder="5"
                                    min="0"
                                    max="100"
                                />
                                <span>%</span>
                            </div>
                        </div>

                        <button
                            className="btn-primary w-full mt-6"
                            onClick={saveSettings}
                        >
                            Сохранить настройки
                        </button>
                    </div>

                    <div className="card">
                        <h3 className="font-semibold mb-4">Учетная запись</h3>

                        {user ? (
                            <div className="space-y-4">
                                <div>
                                    <div className="text-sm text-gray-600">Email</div>
                                    <div className="font-medium">{user.email}</div>
                                </div>

                                <button
                                    className="btn-danger w-full"
                                    onClick={handleLogout}
                                >
                                    Выйти из аккаунта
                                </button>
                            </div>
                        ) : (
                            <div className="text-center py-4 text-gray-600">
                                Вы не вошли в систему
                            </div>
                        )}

                        <div className="mt-6 pt-6 border-t">
                            <h4 className="font-medium mb-3">Информация о приложении</h4>
                            <div className="text-sm space-y-2">
                                <div><strong>Версия:</strong> 1.0.0</div>
                                <div><strong>Разработчик:</strong> Семейный Бюджет</div>
                                <div><strong>Поддержка:</strong> support@familybudget.ru</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<FamilyBudgetApp />, document.getElementById('root'));
    </script>
</body>

</html>
