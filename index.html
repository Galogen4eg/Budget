import React, { useState } from 'react';
import { 
  Wallet, 
  ShoppingBag, 
  Calendar, 
  Plus, 
  Trash2, 
  Check, 
  TrendingUp, 
  TrendingDown,
  Save,
  Search,
  Settings,
  Bot,
  Users,
  Eye,
  EyeOff,
  Send,
  ChevronLeft,
  ChevronRight,
  PieChart
} from 'lucide-react';

const FamilyBudgetApp = () => {
  const [activeTab, setActiveTab] = useState('budget');
  const [transactions, setTransactions] = useState([
    { id: 1, type: 'income', amount: 50000, category: '–ó–∞—Ä–ø–ª–∞—Ç–∞', date: '2024-01-15', description: '–ó–∞—Ä–ø–ª–∞—Ç–∞ –ò–≤–∞–Ω–∞', balanceAfter: 50000 },
    { id: 2, type: 'expense', amount: 15000, category: '–ü—Ä–æ–¥—É–∫—Ç—ã', date: '2024-01-16', description: '–ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤', balanceAfter: 35000 },
    { id: 3, type: 'expense', amount: 8000, category: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', date: '2024-01-17', description: '–ë–µ–Ω–∑–∏–Ω', balanceAfter: 27000 },
    { id: 4, type: 'expense', amount: 5000, category: '–ü—Ä–æ–¥—É–∫—Ç—ã', date: '2024-01-18', description: '–û–≤–æ—â–∏ –∏ —Ñ—Ä—É–∫—Ç—ã', balanceAfter: 22000 },
    { id: 5, type: 'expense', amount: 3000, category: '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', date: '2024-01-19', description: '–ö–∏–Ω–æ', balanceAfter: 19000 }
  ]);
  
  const [shoppingList, setShoppingList] = useState([
    { id: 1, item: '–ú–æ–ª–æ–∫–æ', quantity: 1, unit: '–ª–∏—Ç—Ä', completed: false, frequency: 3 },
    { id: 2, item: '–•–ª–µ–±', quantity: 2, unit: '—à—Ç—É–∫–∞', completed: true, frequency: 5 },
    { id: 3, item: '–Ø–±–ª–æ–∫–∏', quantity: 3, unit: '–∫–∏–ª–æ–≥—Ä–∞–º–º', completed: false, frequency: 2 }
  ]);
  
  const [calendarEvents, setCalendarEvents] = useState([
    { id: 1, title: '–û–ø–ª–∞—Ç–∞ –∫—Ä–µ–¥–∏—Ç–∞', date: '2024-01-20', startTime: '09:00', endTime: '10:00', author: '–ò–≤–∞–Ω', color: 'bg-blue-500', description: '–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç–µ–∂ –ø–æ –∏–ø–æ—Ç–µ–∫–µ' },
    { id: 2, title: '–ü–æ–∫—É–ø–∫–∞ –ø–æ–¥–∞—Ä–∫–∞', date: '2024-01-25', startTime: '14:00', endTime: '15:00', author: '–ú–∞—Ä–∏—è', color: 'bg-pink-500', description: '–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –¥—Ä—É–≥–∞' }
  ]);
  
  const [categories] = useState([
    { id: 1, name: '–ü—Ä–æ–¥—É–∫—Ç—ã', type: 'expense', icon: 'üõí' },
    { id: 2, name: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', type: 'expense', icon: 'üöó' },
    { id: 3, name: '–ñ–∏–ª—å–µ', type: 'expense', icon: 'üè†' },
    { id: 4, name: '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', type: 'expense', icon: 'üéÆ' },
    { id: 5, name: '–ó–¥–æ—Ä–æ–≤—å–µ', type: 'expense', icon: 'üè•' },
    { id: 6, name: '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', type: 'expense', icon: 'üìö' },
    { id: 7, name: '–ó–∞—Ä–ø–ª–∞—Ç–∞', type: 'income', icon: 'üí∞' },
    { id: 8, name: '–§—Ä–∏–ª–∞–Ω—Å', type: 'income', icon: 'üíº' }
  ]);

  // Budget states
  const [initialBalance, setInitialBalance] = useState(0);
  const [savings, setSavings] = useState(10000);
  const [newTransaction, setNewTransaction] = useState({
    type: 'expense',
    amount: '',
    category: '–ü—Ä–æ–¥—É–∫—Ç—ã',
    date: new Date().toISOString().split('T')[0],
    description: ''
  });
  const [searchTerm, setSearchTerm] = useState('');
  const [fixedExpenses, setFixedExpenses] = useState([
    { id: 1, name: '–ê—Ä–µ–Ω–¥–∞', amount: 15000, category: '–ñ–∏–ª—å–µ' },
    { id: 2, name: '–ö—Ä–µ–¥–∏—Ç', amount: 8000, category: '–ñ–∏–ª—å–µ' }
  ]);
  const [showFixedExpenses, setShowFixedExpenses] = useState(false);
  
  // Shopping list states
  const [newItem, setNewItem] = useState({ name: '', quantity: 1, unit: '—à—Ç—É–∫–∞' });
  const [telegramSettings, setTelegramSettings] = useState({
    botToken: '',
    chatId: ''
  });
  const [showProductDictionary, setShowProductDictionary] = useState(false);
  const [productSearch, setProductSearch] = useState('');
  
  // Calendar states
  const [calendarView, setCalendarView] = useState('month');
  const [currentDate, setCurrentDate] = useState(new Date());
  const [newEvent, setNewEvent] = useState({
    title: '',
    date: new Date().toISOString().split('T')[0],
    startTime: '09:00',
    endTime: '10:00',
    author: '–ò–≤–∞–Ω',
    description: ''
  });
  const [authorNames, setAuthorNames] = useState(['–ò–≤–∞–Ω', '–ú–∞—Ä–∏—è']);

  // Product dictionary
  const productDictionary = [
    '–ú–æ–ª–æ–∫–æ', '–•–ª–µ–±', '–Ø–π—Ü–∞', '–°—ã—Ä', '–ú–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ', '–¢–≤–æ—Ä–æ–≥', '–ô–æ–≥—É—Ä—Ç', '–ö–µ—Ñ–∏—Ä',
    '–Ø–±–ª–æ–∫–∏', '–ë–∞–Ω–∞–Ω—ã', '–ê–ø–µ–ª—å—Å–∏–Ω—ã', '–ì—Ä—É—à–∏', '–í–∏–Ω–æ–≥—Ä–∞–¥', '–ö–∏–≤–∏', '–ú–∞–Ω–¥–∞—Ä–∏–Ω—ã',
    '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å', '–ú–æ—Ä–∫–æ–≤—å', '–õ—É–∫', '–ß–µ—Å–Ω–æ–∫', '–ü–æ–º–∏–¥–æ—Ä—ã', '–û–≥—É—Ä—Ü—ã', '–ö–∞–ø—É—Å—Ç–∞',
    '–ö—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞', '–°–≤–∏–Ω–∏–Ω–∞', '–ì–æ–≤—è–¥–∏–Ω–∞', '–†—ã–±–∞', '–ö–æ–ª–±–∞—Å–∞', '–°–æ—Å–∏—Å–∫–∏',
    '–†–∏—Å', '–ì—Ä–µ—á–∫–∞', '–ú–∞–∫–∞—Ä–æ–Ω—ã', '–û–≤—Å—è–Ω–∫–∞', '–ú—É–∫–∞', '–°–∞—Ö–∞—Ä', '–°–æ–ª—å',
    '–ß–∞–π', '–ö–æ—Ñ–µ', '–°–æ–∫', '–ú–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è –≤–æ–¥–∞', '–õ–∏–º–æ–Ω–∞–¥',
    '–®–∞–º–ø—É–Ω—å', '–ú—ã–ª–æ', '–ó—É–±–Ω–∞—è –ø–∞—Å—Ç–∞', '–ì–µ–ª—å –¥–ª—è –¥—É—à–∞',
    '–ü–æ–¥–≥—É–∑–Ω–∏–∫–∏', '–í–ª–∞–∂–Ω—ã–µ —Å–∞–ª—Ñ–µ—Ç–∫–∏', '–ü–µ–ª–µ–Ω–∫–∏'
  ];

  // Units for shopping list
  const units = ['—à—Ç—É–∫–∞', '–ª–∏—Ç—Ä', '–≥—Ä–∞–º–º', '–∫–∏–ª–æ–≥—Ä–∞–º–º', '–º–µ—Ç—Ä', '—É–ø–∞–∫–æ–≤–∫–∞'];

  // Calculate financial metrics
  const totalIncome = transactions
    .filter(t => t.type === 'income')
    .reduce((sum, t) => sum + t.amount, 0);
  
  const totalExpenses = transactions
    .filter(t => t.type === 'expense')
    .reduce((sum, t) => sum + t.amount, 0);
  
  const fixedExpensesTotal = fixedExpenses.reduce((sum, expense) => sum + expense.amount, 0);
  const balance = initialBalance + totalIncome - totalExpenses;
  const availableToSave = balance - savings;
  const dailySpendingLimit = Math.max(0, (availableToSave - fixedExpensesTotal) / 30);

  // Get expenses by category
  const getExpensesByCategory = () => {
    const expenseTransactions = transactions.filter(t => t.type === 'expense');
    const categoryTotals = {};
    
    expenseTransactions.forEach(transaction => {
      if (categoryTotals[transaction.category]) {
        categoryTotals[transaction.category] += transaction.amount;
      } else {
        categoryTotals[transaction.category] = transaction.amount;
      }
    });
    
    return Object.entries(categoryTotals).map(([category, amount]) => ({
      category,
      amount,
      percentage: ((amount / totalExpenses) * 100).toFixed(1)
    })).sort((a, b) => b.amount - a.amount);
  };

  const expensesByCategory = getExpensesByCategory();

  // Add transaction
  const addTransaction = () => {
    if (newTransaction.amount && newTransaction.description) {
      const transaction = {
        id: Date.now(),
        ...newTransaction,
        amount: parseFloat(newTransaction.amount),
        balanceAfter: calculateBalanceAfterNewTransaction()
      };
      setTransactions([...transactions, transaction]);
      setNewTransaction({
        type: 'expense',
        amount: '',
        category: '–ü—Ä–æ–¥—É–∫—Ç—ã',
        date: new Date().toISOString().split('T')[0],
        description: ''
      });
    }
  };

  const calculateBalanceAfterNewTransaction = () => {
    const lastBalance = transactions.length > 0 ? transactions[transactions.length - 1].balanceAfter : initialBalance;
    const amount = parseFloat(newTransaction.amount) || 0;
    return newTransaction.type === 'income' ? lastBalance + amount : lastBalance - amount;
  };

  // Add shopping item
  const addShoppingItem = () => {
    if (newItem.name.trim()) {
      const item = {
        id: Date.now(),
        item: newItem.name,
        quantity: parseInt(newItem.quantity) || 1,
        unit: newItem.unit,
        completed: false,
        frequency: 1
      };
      setShoppingList([...shoppingList, item]);
      setNewItem({ name: '', quantity: 1, unit: '—à—Ç—É–∫–∞' });
    }
  };

  // Toggle shopping item
  const toggleShoppingItem = (id) => {
    setShoppingList(shoppingList.map(item => 
      item.id === id ? { ...item, completed: !item.completed } : item
    ));
  };

  // Add calendar event
  const addCalendarEvent = () => {
    if (newEvent.title) {
      const colors = ['bg-blue-500', 'bg-pink-500', 'bg-green-500', 'bg-yellow-500', 'bg-purple-500'];
      const authorIndex = authorNames.indexOf(newEvent.author);
      const color = colors[authorIndex % colors.length];
      
      const event = {
        id: Date.now(),
        ...newEvent,
        color
      };
      setCalendarEvents([...calendarEvents, event]);
      setNewEvent({
        title: '',
        date: new Date().toISOString().split('T')[0],
        startTime: '09:00',
        endTime: '10:00',
        author: authorNames[0],
        description: ''
      });
    }
  };

  // Delete functions
  const deleteTransaction = (id) => {
    setTransactions(transactions.filter(t => t.id !== id));
  };

  const deleteShoppingItem = (id) => {
    setShoppingList(shoppingList.filter(item => item.id !== id));
  };

  const deleteCalendarEvent = (id) => {
    setCalendarEvents(calendarEvents.filter(event => event.id !== id));
  };

  const deleteFixedExpense = (id) => {
    setFixedExpenses(fixedExpenses.filter(expense => expense.id !== id));
  };

  // Calendar navigation
  const navigateCalendar = (direction) => {
    const newDate = new Date(currentDate);
    if (calendarView === 'month') {
      newDate.setMonth(newDate.getMonth() + direction);
    } else {
      newDate.setDate(newDate.getDate() + (direction * 7));
    }
    setCurrentDate(newDate);
  };

  // Get calendar data
  const getCalendarData = () => {
    if (calendarView === 'month') {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      
      const startDate = new Date(firstDay);
      startDate.setDate(startDate.getDate() - firstDay.getDay());
      
      const endDate = new Date(lastDay);
      endDate.setDate(endDate.getDate() + (6 - lastDay.getDay()));
      
      const days = [];
      const currentDateIter = new Date(startDate);
      
      while (currentDateIter <= endDate) {
        days.push(new Date(currentDateIter));
        currentDateIter.setDate(currentDateIter.getDate() + 1);
      }
      
      return { days, title: currentDate.toLocaleString('ru-RU', { month: 'long', year: 'numeric' }) };
    } else {
      const startOfWeek = new Date(currentDate);
      startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
      
      const days = [];
      for (let i = 0; i < 7; i++) {
        const day = new Date(startOfWeek);
        day.setDate(startOfWeek.getDate() + i);
        days.push(day);
      }
      
      return { days, title: `${days[0].toLocaleDateString('ru-RU')} - ${days[6].toLocaleDateString('ru-RU')}` };
    }
  };

  const { days, title } = getCalendarData();

  // Get events for specific date
  const getEventsForDate = (date) => {
    return calendarEvents.filter(event => 
      new Date(event.date).toDateString() === date.toDateString()
    );
  };

  // Get transactions for specific date
  const getTransactionsForDate = (date) => {
    return transactions.filter(transaction => 
      new Date(transaction.date).toDateString() === date.toDateString()
    );
  };

  // Filtered transactions for search
  const filteredTransactions = transactions.filter(transaction =>
    transaction.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
    transaction.category.toLowerCase().includes(searchTerm.toLowerCase())
  );

  // Top frequent purchases
  const topPurchases = shoppingList
    .filter(item => item.frequency > 1)
    .sort((a, b) => b.frequency - a.frequency)
    .slice(0, 5);

  // Add fixed expense
  const addFixedExpense = () => {
    const expense = {
      id: Date.now(),
      name: '–ù–æ–≤–∞—è —Ç—Ä–∞—Ç–∞',
      amount: 0,
      category: '–ü—Ä–æ–¥—É–∫—Ç—ã'
    };
    setFixedExpenses([...fixedExpenses, expense]);
  };

  // Send shopping list
  const sendShoppingList = () => {
    alert('–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram!');
  };

  // Get current month calendar for budget view
  const getCurrentMonthCalendar = () => {
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth();
    
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay());
    
    const endDate = new Date(lastDay);
    endDate.setDate(endDate.getDate() + (6 - lastDay.getDay()));
    
    const days = [];
    const currentDate = new Date(startDate);
    
    while (currentDate <= endDate) {
      days.push(new Date(currentDate));
      currentDate.setDate(currentDate.getDate() + 1);
    }
    
    return { days, currentMonth: today.toLocaleString('ru-RU', { month: 'long', year: 'numeric' }) };
  };

  const { days: budgetDays, currentMonth } = getCurrentMonthCalendar();

  // Get expenses for specific date in budget calendar
  const getExpensesForDate = (date) => {
    return transactions.filter(transaction => 
      transaction.type === 'expense' &&
      new Date(transaction.date).toDateString() === date.toDateString()
    );
  };

  // Get proper unit form based on quantity
  const getUnitForm = (quantity, unit) => {
    if (unit === '—à—Ç—É–∫–∞') {
      const num = parseInt(quantity);
      if (num === 1) return '—à—Ç—É–∫–∞';
      if (num > 1 && num < 5) return '—à—Ç—É–∫–∏';
      return '—à—Ç—É–∫';
    }
    if (unit === '–ª–∏—Ç—Ä') {
      const num = parseInt(quantity);
      if (num === 1) return '–ª–∏—Ç—Ä';
      if (num > 1 && num < 5) return '–ª–∏—Ç—Ä–∞';
      return '–ª–∏—Ç—Ä–æ–≤';
    }
    if (unit === '–∫–∏–ª–æ–≥—Ä–∞–º–º') {
      const num = parseInt(quantity);
      if (num === 1) return '–∫–∏–ª–æ–≥—Ä–∞–º–º';
      if (num > 1 && num < 5) return '–∫–∏–ª–æ–≥—Ä–∞–º–º–∞';
      return '–∫–∏–ª–æ–≥—Ä–∞–º–º–æ–≤';
    }
    if (unit === '–≥—Ä–∞–º–º') {
      const num = parseInt(quantity);
      if (num === 1) return '–≥—Ä–∞–º–º';
      if (num > 1 && num < 5) return '–≥—Ä–∞–º–º–∞';
      return '–≥—Ä–∞–º–º–æ–≤';
    }
    if (unit === '–º–µ—Ç—Ä') {
      const num = parseInt(quantity);
      if (num === 1) return '–º–µ—Ç—Ä';
      if (num > 1 && num < 5) return '–º–µ—Ç—Ä–∞';
      return '–º–µ—Ç—Ä–æ–≤';
    }
    if (unit === '—É–ø–∞–∫–æ–≤–∫–∞') {
      const num = parseInt(quantity);
      if (num === 1) return '—É–ø–∞–∫–æ–≤–∫–∞';
      if (num > 1 && num < 5) return '—É–ø–∞–∫–æ–≤–∫–∏';
      return '—É–ø–∞–∫–æ–≤–æ–∫';
    }
    return unit;
  };

  // Select product from dictionary
  const selectProduct = (product) => {
    setNewItem({...newItem, name: product});
    setShowProductDictionary(false);
    setProductSearch('');
  };

  // Filter products based on search
  const filteredProducts = productDictionary.filter(product =>
    product.toLowerCase().includes(productSearch.toLowerCase())
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100">
      {/* Header */}
      <header className="bg-white shadow-lg sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-4">
          <div className="flex justify-between items-center py-4">
            <h1 className="text-2xl font-bold text-purple-800">–°–µ–º–µ–π–Ω—ã–π –ë—é–¥–∂–µ—Ç</h1>
            <nav className="flex space-x-1">
              {[
                { id: 'budget', label: '–ë—é–¥–∂–µ—Ç', icon: Wallet },
                { id: 'shopping', label: '–ü–æ–∫—É–ø–∫–∏', icon: ShoppingBag },
                { id: 'calendar', label: '–ö–∞–ª–µ–Ω–¥–∞—Ä—å', icon: Calendar }
              ].map(({ id, label, icon: Icon }) => (
                <button
                  key={id}
                  onClick={() => setActiveTab(id)}
                  className={`flex items-center space-x-2 px-4 py-2 rounded-lg transition-all ${
                    activeTab === id
                      ? 'bg-purple-600 text-white shadow-md'
                      : 'text-gray-600 hover:bg-purple-100'
                  }`}
                >
                  <Icon size={20} />
                  <span className="hidden sm:inline">{label}</span>
                </button>
              ))}
            </nav>
          </div>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 py-8">
        {/* Budget Tab */}
        {activeTab === 'budget' && (
          <div className="space-y-6">
            {/* Financial Summary Cards - Two Column Layout */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="bg-white rounded-xl shadow-lg p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-600">–ù–∞—á–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫</p>
                    <input
                      type="number"
                      value={initialBalance}
                      onChange={(e) => setInitialBalance(parseFloat(e.target.value) || 0)}
                      className="text-2xl font-bold text-purple-600 w-full bg-transparent border-b border-transparent hover:border-gray-300 focus:border-purple-500 focus:outline-none"
                    />
                  </div>
                  <Wallet className="text-purple-500" size={32} />
                </div>
              </div>
              
              <div className="bg-white rounded-xl shadow-lg p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-600">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</p>
                    <p className={`text-2xl font-bold ${balance >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                      {balance.toLocaleString('ru-RU')} ‚ÇΩ
                    </p>
                  </div>
                  <Save className="text-blue-500" size={32} />
                </div>
              </div>
              
              <div className="bg-white rounded-xl shadow-lg p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-600">–ú–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å</p>
                    <p className="text-2xl font-bold text-green-600">
                      {availableToSave.toLocaleString('ru-RU')} ‚ÇΩ
                    </p>
                  </div>
                  <TrendingUp className="text-green-500" size={32} />
                </div>
              </div>
              
              <div className="bg-white rounded-xl shadow-lg p-6">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-600">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ –º–æ–∂–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—å</p>
                    <p className="text-2xl font-bold text-orange-600">
                      {dailySpendingLimit.toLocaleString('ru-RU', { maximumFractionDigits: 0 })} ‚ÇΩ
                    </p>
                  </div>
                  <TrendingDown className="text-orange-500" size={32} />
                </div>
              </div>
            </div>

            {/* Fixed Expenses - Collapsible */}
            <div className="bg-white rounded-xl shadow-lg p-6">
              <button
                onClick={() => setShowFixedExpenses(!showFixedExpenses)}
                className="flex items-center justify-between w-full"
              >
                <h2 className="text-xl font-semibold text-gray-800">–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–∞—Ç—ã</h2>
                <div className="flex items-center space-x-2">
                  <span className="text-sm text-gray-600">
                    {fixedExpenses.length} –∑–∞–ø–∏—Å–µ–π ({fixedExpensesTotal.toLocaleString('ru-RU')} ‚ÇΩ)
                  </span>
                  {showFixedExpenses ? <EyeOff size={20} /> : <Eye size={20} />}
                </div>
              </button>
              
              {showFixedExpenses && (
                <div className="mt-4">
                  <div className="flex justify-end mb-4">
                    <button
                      onClick={addFixedExpense}
                      className="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center"
                    >
                      <Plus size={16} />
                      <span className="ml-2">–î–æ–±–∞–≤–∏—Ç—å</span>
                    </button>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {fixedExpenses.map(expense => (
                      <div key={expense.id} className="border border-gray-200 rounded-lg p-4">
                        <div className="flex justify-between items-start">
                          <div>
                            <h3 className="font-medium">{expense.name}</h3>
                            <p className="text-sm text-gray-600">{expense.category}</p>
                          </div>
                          <button
                            onClick={() => deleteFixedExpense(expense.id)}
                            className="text-red-500 hover:text-red-700"
                          >
                            <Trash2 size={16} />
                          </button>
                        </div>
                        <p className="text-lg font-bold text-red-600 mt-2">
                          {expense.amount.toLocaleString('ru-RU')} ‚ÇΩ
                        </p>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>

            {/* Expenses by Category */}
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h2 className="text-xl font-semibold mb-4 text-gray-800">–†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div className="space-y-4">
                  {expensesByCategory.map(({ category, amount, percentage }) => {
                    const categoryInfo = categories.find(c => c.name === category);
                    return (
                      <div key={category} className="space-y-2">
                        <div className="flex justify-between">
                          <div className="flex items-center space-x-2">
                            <span>{categoryInfo?.icon || 'üìù'}</span>
                            <span className="font-medium">{category}</span>
                          </div>
                          <span className="font-semibold">{amount.toLocaleString('ru-RU')} ‚ÇΩ</span>
                        </div>
                        <div className="flex items-center">
                          <div className="flex-1 bg-gray-200 rounded-full h-2">
                            <div 
                              className="bg-purple-600 h-2 rounded-full" 
                              style={{ width: `${percentage}%` }}
                            ></div>
                          </div>
                          <span className="text-sm text-gray-600 ml-2">{percentage}%</span>
                        </div>
                      </div>
                    );
                  })}
                </div>
                <div className="flex items-center justify-center">
                  <PieChart className="text-purple-300" size={150} />
                </div>
              </div>
            </div>

            {/* Budget Calendar */}
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h2 className="text-xl font-semibold mb-4 text-gray-800">–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ä–∞—Å—Ö–æ–¥–æ–≤ - {currentMonth}</h2>
              <div className="grid grid-cols-7 gap-1 mb-2">
                {['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'].map(day => (
                  <div key={day} className="text-center py-2 text-sm font-medium text-gray-600">
                    {day}
                  </div>
                ))}
              </div>
              
              <div className="grid grid-cols-7 gap-1">
                {budgetDays.map((day, index) => {
                  const isCurrentMonth = day.getMonth() === new Date().getMonth();
                  const expenses = getExpensesForDate(day);
                  const totalExpensesForDay = expenses.reduce((sum, exp) => sum + exp.amount, 0);
                  
                  return (
                    <div
                      key={index}
                      className={`min-h-20 p-1 border border-gray-100 ${
                        isCurrentMonth ? 'bg-white' : 'bg-gray-50 text-gray-400'
                      }`}
                    >
                      <div className="text-xs font-medium mb-1 text-center">
                        {day.getDate()}
                      </div>
                      
                      {totalExpensesForDay > 0 && (
                        <div className="text-center">
                          <div className="text-xs font-bold text-red-600">
                            {totalExpensesForDay.toLocaleString('ru-RU')} ‚ÇΩ
                          </div>
                          <div className="text-xs text-gray-500">
                            {expenses.length} —Ç—Ä–∞—Ç
                          </div>
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>

            {/* Add Transaction */}
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h2 className="text-xl font-semibold mb-4 text-gray-800">–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4">
                <select
                  value={newTransaction.type}
                  onChange={(e) => setNewTransaction({...newTransaction, type: e.target.value})}
                  className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
                  <option value="income">–î–æ—Ö–æ–¥</option>
                  <option value="expense">–†–∞—Å—Ö–æ–¥</option>
                </select>
                
                <input
                  type="number"
                  placeholder="–°—É–º–º–∞"
                  value={newTransaction.amount}
                  onChange={(e) => setNewTransaction({...newTransaction, amount: e.target.value})}
                  className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
                
                <select
                  value={newTransaction.category}
                  onChange={(e) => setNewTransaction({...newTransaction, category: e.target.value})}
                  className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
                  {categories.filter(cat => cat.type === newTransaction.type).map(category => (
                    <option key={category.id} value={category.name}>{category.icon} {category.name}</option>
                  ))}
                </select>
                
                <input
                  type="date"
                  value={newTransaction.date}
                  onChange={(e) => setNewTransaction({...newTransaction, date: e.target.value})}
                  className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
                
                <input
                  type="text"
                  placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"
                  value={newTransaction.description}
                  onChange={(e) => setNewTransaction({...newTransaction, description: e.target.value})}
                  className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
                
                <button
                  onClick={addTransaction}
                  className="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center"
                >
                  <Plus size={20} />
                </button>
              </div>
            </div>

            {/* Search and Transactions List */}
            <div className="bg-white rounded-xl shadow-lg p-6">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl font-semibold text-gray-800">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
                <div className="relative">
                  <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={20} />
                  <input
                    type="text"
                    placeholder="–ü–æ–∏—Å–∫ –æ–ø–µ—Ä–∞—Ü–∏–π..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  />
                </div>
              </div>
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead>
                    <tr className="border-b border-gray-200">
                      <th className="text-left py-3 px-4">–î–∞—Ç–∞</th>
                      <th className="text-left py-3 px-4">–û–ø–∏—Å–∞–Ω–∏–µ</th>
                      <th className="text-left py-3 px-4">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                      <th className="text-left py-3 px-4">–°—É–º–º–∞</th>
                      <th className="text-left py-3 px-4">–ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ</th>
                      <th className="text-left py-3 px-4">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                  </thead>
                  <tbody>
                    {filteredTransactions.slice().reverse().map(transaction => (
                      <tr key={transaction.id} className="border-b border-gray-100 hover:bg-gray-50">
                        <td className="py-3 px-4">{new Date(transaction.date).toLocaleDateString('ru-RU')}</td>
                        <td className="py-3 px-4">{transaction.description}</td>
                        <td className="py-3 px-4">
                          <span className="px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-sm">
                            {categories.find(c => c.name === transaction.category)?.icon || 'üìù'} {transaction.category}
                          </span>
                        </td>
                        <td className={`py-3 px-4 font-semibold ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}`}>
                          {transaction.type === 'income' ? '+' : '-'}{transaction.amount.toLocaleString('ru-RU')} ‚ÇΩ
                        </td>
                        <td className={`py-3 px-4 font-semibold ${transaction.balanceAfter >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                          {transaction.balanceAfter.toLocaleString('ru-RU')} ‚ÇΩ
                        </td>
                        <td className="py-3 px-4">
                          <button
                            onClick={() => deleteTransaction(transaction.id)}
                            className="text-red-500 hover:text-red-700"
                          >
                            <Trash2 size={18} />
                          </button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        )}

        {/* Shopping List Tab */}
        {activeTab === 'shopping' && (
          <div className="space-y-6">
            {/* Quick Add - Three Column Layout */}
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h2 className="text-xl font-semibold mb-4 text-gray-800">–ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</h2>
              <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div className="relative">
                  <input
                    type="text"
                    placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
                    value={newItem.name}
                    onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                    onFocus={() => setShowProductDictionary(true)}
                    className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent w-full"
                  />
                  {showProductDictionary && (
                    <div className="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                      <div className="p-2">
                        <input
                          type="text"
                          placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..."
                          value={productSearch}
                          onChange={(e) => setProductSearch(e.target.value)}
                          className="w-full px-3 py-2 border border-gray-300 rounded mb-2"
                        />
                      </div>
                      <div className="max-h-40 overflow-y-auto">
                        {filteredProducts.map(product => (
                          <div
                            key={product}
                            onClick={() => selectProduct(product)}
                            className="px-4 py-2 hover:bg-purple-100 cursor-pointer"
                          >
                            {product}
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
                
                <input
                  type="number"
                  placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ"
                  value={newItem.quantity}
                  onChange={(e) => setNewItem({...newItem, quantity: e.target.value})}
                  className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                />
                
                <select
                  value={newItem.unit}
                  onChange={(e) => setNewItem({...newItem, unit: e.target.value})}
                  className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                >
                  {units.map(unit => (
                    <option key={unit} value={unit}>{unit}</option>
                  ))}
                </select>
                
                <button
                  onClick={addShoppingItem}
                  className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg transition-colors flex items-center justify-center"
                >
                  <Plus size={20} />
                  <span className="ml-2">–î–æ–±–∞–≤–∏—Ç—å</span>
                </button>
              </div>
              
              <div className="flex justify-end mt-4">
                <button
                  onClick={sendShoppingList}
                  className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors flex items-center"
                >
                  <Send size={20} className="mr-2" />
                  –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
                </button>
              </div>
            </div>

            {/* Shopping List and Top Purchases - Two Column Layout */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Shopping List */}
              <div className="bg-white rounded-xl shadow-lg p-6">
                <h2 className="text-xl font-semibold mb-4 text-gray-800">–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h2>
                <div className="space-y-2">
                  {shoppingList.map(item => (
                    <div key={item.id} className="flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                      <div className="flex items-center space-x-3">
                        <button
                          onClick={() => toggleShoppingItem(item.id)}
                          className={`w-5 h-5 rounded border-2 flex items-center justify-center ${
                            item.completed 
                              ? 'bg-green-500 border-green-500 text-white' 
                              : 'border-gray-300'
                          }`}
                        >
                          {item.completed && <Check size={14} />}
                        </button>
                        <div>
                          <span className={`${item.completed ? 'line-through text-gray-500' : 'text-gray-800'}`}>
                            {item.item}
                          </span>
                          <span className="text-sm text-gray-600 ml-2">
                            √ó {item.quantity} {getUnitForm(item.quantity, item.unit)}
                          </span>
                        </div>
                        {item.frequency > 2 && (
                          <span className="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs">
                            –ß–∞—Å—Ç–æ
                          </span>
                        )}
                      </div>
                      <button
                        onClick={() => deleteShoppingItem(item.id)}
                        className="text-red-500 hover:text-red-700"
                      >
                        <Trash2 size={18} />
                      </button>
                    </div>
                  ))}
                </div>
              </div>

              {/* Top Purchases */}
              <div className="bg-white rounded-xl shadow-lg p-6">
                <h2 className="text-xl font-semibold mb-4 text-gray-800">–ß–∞—Å—Ç—ã–µ –ø–æ–∫—É–ø–∫–∏</h2>
                <div className="space-y-3">
                  {topPurchases.map(item => (
                    <div key={item.id} className="border border-gray-200 rounded-lg p-4">
                      <div className="flex justify-between items-center">
                        <span className="font-medium">{item.item}</span>
                        <span className="text-sm text-gray-600">
                          {item.quantity} {getUnitForm(item.quantity, item.unit)}
                        </span>
                      </div>
                      <div className="flex items-center mt-2">
                        <div className="flex-1 bg-gray-200 rounded-full h-2">
                          <div 
                            className="bg-purple-600 h-2 rounded-full" 
                            style={{ width: `${Math.min(item.frequency * 20, 100)}%` }}
                          ></div>
                        </div>
                        <span className="text-sm text-gray-600 ml-2">{item.frequency}</span>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>

            {/* Telegram Settings */}
            <div className="bg-white rounded-xl shadow-lg p-6">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-xl font-semibold text-gray-800">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram</h2>
                <Settings className="text-purple-500" size={24} />
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    <Bot className="inline mr-2" size={16} />
                    –¢–æ–∫–µ–Ω –±–æ—Ç–∞
                  </label>
                  <input
                    type="password"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞"
                    value={telegramSettings.botToken}
                    onChange={(e) => setTelegramSettings({...telegramSettings, botToken: e.target.value})}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    <Users className="inline mr-2" size={16} />
                    ID —á–∞—Ç–∞/–≥—Ä—É–ø–ø—ã
                  </label>
                  <input
                    type="text"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ ID —á–∞—Ç–∞"
                    value={telegramSettings.chatId}
                    onChange={(e) => setTelegramSettings({...telegramSettings, chatId: e.target.value})}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  />
                </div>
              </div>
              <button className="mt-4 bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg transition-colors">
                –ü–æ–¥–∫–ª—é—á–∏—Ç—å Telegram
              </button>
            </div>
          </div>
        )}

        {/* Calendar Tab */}
        {activeTab === 'calendar' && (
          <div className="space-y-6">
            {/* Calendar Header */}
            <div className="bg-white rounded-xl shadow-lg p-6">
              <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0">
                <div className="flex items-center space-x-4">
                  <button
                    onClick={() => navigateCalendar(-1)}
                    className="p-2 rounded-lg hover:bg-gray-100"
                  >
                    <ChevronLeft size={20} />
                  </button>
                  <h2 className="text-xl font-semibold text-gray-800">{title}</h2>
                  <button
                    onClick={() => navigateCalendar(1)}
                    className="p-2 rounded-lg hover:bg-gray-100"
                  >
                    <ChevronRight size={20} />
                  </button>
                </div>
                
                <div className="flex space-x-2">
                  <button
                    onClick={() => setCalendarView('month')}
                    className={`px-4 py-2 rounded-lg transition-colors ${
                      calendarView === 'month' 
                        ? 'bg-purple-600 text-white' 
                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                    }`}
                  >
                    –ú–µ—Å—è—Ü
                  </button>
                  <button
                    onClick={() => setCalendarView('week')}
                    className={`px-4 py-2 rounded-lg transition-colors ${
                      calendarView === 'week' 
                        ? 'bg-purple-600 text-white' 
                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                    }`}
                  >
                    –ù–µ–¥–µ–ª—è
                  </button>
                </div>
              </div>
            </div>

            {/* Add Event Form */}
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h2 className="text-xl font-semibold mb-4 text-gray-800">–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <input
                    type="text"
                    placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è"
                    value={newEvent.title}
                    onChange={(e) => setNewEvent({...newEvent, title: e.target.value})}
                    className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent md:col-span-2"
                  />
                  
                  <input
                    type="date"
                    value={newEvent.date}
                    onChange={(e) => setNewEvent({...newEvent, date: e.target.value})}
                    className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  />
                  
                  <div className="flex space-x-2">
                    <input
                      type="time"
                      value={newEvent.startTime}
                      onChange={(e) => setNewEvent({...newEvent, startTime: e.target.value})}
                      className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    />
                    <span className="flex items-center">-</span>
                    <input
                      type="time"
                      value={newEvent.endTime}
                      onChange={(e) => setNewEvent({...newEvent, endTime: e.target.value})}
                      className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    />
                  </div>
                </div>
                
                <div className="grid grid-cols-1 gap-4">
                  <select
                    value={newEvent.author}
                    onChange={(e) => setNewEvent({...newEvent, author: e.target.value})}
                    className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  >
                    {authorNames.map(name => (
                      <option key={name} value={name}>{name}</option>
                    ))}
                  </select>
                  
                  <textarea
                    placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è"
                    value={newEvent.description}
                    onChange={(e) => setNewEvent({...newEvent, description: e.target.value})}
                    className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    rows="3"
                  />
                  
                  <button
                    onClick={addCalendarEvent}
                    className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg transition-colors flex items-center justify-center"
                  >
                    <Plus size={20} />
                    <span className="ml-2">–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</span>
                  </button>
                </div>
              </div>
            </div>

            {/* Calendar View */}
            <div className="bg-white rounded-xl shadow-lg p-6">
              {calendarView === 'month' ? (
                <>
                  <div className="grid grid-cols-7 gap-1 mb-2">
                    {['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'].map(day => (
                      <div key={day} className="text-center py-2 text-sm font-medium text-gray-600">
                        {day}
                      </div>
                    ))}
                  </div>
                  
                  <div className="grid grid-cols-7 gap-1">
                    {days.map((day, index) => {
                      const isCurrentMonth = day.getMonth() === currentDate.getMonth();
                      const events = getEventsForDate(day);
                      const transactions = getTransactionsForDate(day);
                      
                      return (
                        <div
                          key={index}
                          className={`min-h-24 p-2 border border-gray-100 relative ${
                            isCurrentMonth ? 'bg-white' : 'bg-gray-50 text-gray-400'
                          }`}
                        >
                          <div className="text-sm font-medium mb-1">
                            {day.getDate()}
                          </div>
                          
                          <div className="space-y-1">
                            {events.slice(0, 2).map(event => (
                              <div
                                key={event.id}
                                className={`text-xs p-1 rounded text-white truncate ${event.color}`}
                                title={event.title}
                              >
                                {event.title}
                              </div>
                            ))}
                            
                            {transactions.slice(0, 2).map(transaction => (
                              <div
                                key={transaction.id}
                                className={`text-xs p-1 rounded truncate ${
                                  transaction.type === 'income' 
                                    ? 'bg-green-100 text-green-800' 
                                    : 'bg-red-100 text-red-800'
                                }`}
                                title={transaction.description}
                              >
                                {transaction.type === 'income' ? '+' : '-'}{transaction.amount} ‚ÇΩ
                              </div>
                            ))}
                            
                            {(events.length > 2 || transactions.length > 2) && (
                              <div className="text-xs text-gray-500">
                                +{(events.length - 2) + (transactions.length - 2)} –µ—â–µ
                              </div>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </>
              ) : (
                <div className="space-y-4">
                  {days.map(day => {
                    const events = getEventsForDate(day);
                    const transactions = getTransactionsForDate(day);
                    
                    return (
                      <div key={day.toISOString()} className="border border-gray-200 rounded-lg p-4">
                        <h3 className="font-semibold mb-3">
                          {day.toLocaleDateString('ru-RU', { weekday: 'long', day: 'numeric', month: 'long' })}
                        </h3>
                        
                        <div className="space-y-3">
                          {[...events, ...transactions].map(item => {
                            if (item.type) {
                              // Transaction
                              return (
                                <div key={item.id} className="flex items-start space-x-3 p-3 rounded-lg border-l-4 border-purple-500">
                                  <div className="flex-1">
                                    <div className="font-medium">{item.description}</div>
                                    <div className="text-sm text-gray-600">
                                      {item.category} ‚Ä¢ {new Date(item.date).toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}
                                    </div>
                                  </div>
                                  <div className={`font-semibold ${item.type === 'income' ? 'text-green-600' : 'text-red-600'}`}>
                                    {item.type === 'income' ? '+' : '-'}{item.amount.toLocaleString('ru-RU')} ‚ÇΩ
                                  </div>
                                </div>
                              );
                            } else {
                              // Event
                              return (
                                <div key={item.id} className="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                                  <div className={`w-3 h-3 rounded-full mt-1 ${item.color}`}></div>
                                  <div className="flex-1">
                                    <div className="font-medium">{item.title}</div>
                                    <div className="text-sm text-gray-600">
                                      {item.startTime} - {item.endTime} ‚Ä¢ {item.author}
                                    </div>
                                    {item.description && (
                                      <div className="text-sm text-gray-700 mt-1">{item.description}</div>
                                    )}
                                  </div>
                                  <button
                                    onClick={() => deleteCalendarEvent(item.id)}
                                    className="text-red-500 hover:text-red-700"
                                  >
                                    <Trash2 size={16} />
                                  </button>
                                </div>
                              );
                            }
                          })}
                          
                          {events.length === 0 && transactions.length === 0 && (
                            <div className="text-center text-gray-500 py-4">
                              –ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –∏ —Ç—Ä–∞—Ç –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å
                            </div>
                          )}
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          </div>
        )}
      </main>
    </div>
  );
};

export default FamilyBudgetApp;