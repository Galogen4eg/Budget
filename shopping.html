<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</title>
    <meta name="description" content="–ë—ã—Å—Ç—Ä—ã–π –∏ —É–¥–æ–±–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ —Å —à–∞–±–ª–æ–Ω–∞–º–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π">
    <meta name="theme-color" content="#667eea">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        .header-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: white;
            box-shadow: 0 4px 18px rgba(102, 126, 234, 0.35);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }
        .header-gradient::after {
            content: '';
            position: absolute;
            inset: 12px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.2);
            pointer-events: none;
        }
        .header-gradient h1,
        .header-gradient p {
            position: relative;
            z-index: 1;
        }
        .header-gradient p {
            color: rgba(255,255,255,0.92);
        }
        .shopping-item {
            transition: transform 0.2s ease, opacity 0.2s ease;
        }
        .shopping-item.swiped {
            transform: translateX(60px);
            opacity: 0.4;
        }
        .catalog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.65rem;
        }
        .catalog-card {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.4rem;
            padding: 0.65rem 0.7rem;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            background: #fff;
            min-height: 110px;
            box-shadow: 0 1px 3px rgba(15, 23, 42, 0.06);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }
        .catalog-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(15, 23, 42, 0.08);
        }
        .catalog-icon {
            width: 32px;
            height: 32px;
            border-radius: 999px;
            background: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        .catalog-card button {
            font-size: 0.72rem;
            padding: 4px 12px;
            border-radius: 999px;
            white-space: nowrap;
            align-self: stretch;
            justify-content: center;
        }
        .catalog-text {
            width: 100%;
        }
        .catalog-meta {
            font-size: 0.6rem;
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            margin-bottom: 2px;
        }
        .catalog-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #1f2937;
            line-height: 1.25;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            min-height: 2.4em;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen py-6 px-4">
    <div class="max-w-4xl mx-auto space-y-4">
        <header class="header-gradient text-center rounded-2xl p-6 shadow-lg">
            <h1 class="text-2xl md:text-3xl font-semibold mb-2">üõçÔ∏è –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h1>
            <p class="text-white/90 text-sm max-w-xl mx-auto">–î–æ–±–∞–≤–ª—è–π—Ç–µ –ø–æ–∑–∏—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—Ç–∞–ª–æ–≥ –∏–ª–∏ —Å–≤–æ–∏ —à–∞–±–ª–æ–Ω—ã</p>
            <div class="mt-4 grid grid-cols-2 max-w-md mx-auto gap-3 text-sm font-medium">
                <a href="index.html" class="px-6 py-3 rounded-2xl bg-white/20 text-white border border-white/30 shadow-inner flex items-center justify-center gap-2 transition">
                    üìä –ë—é–¥–∂–µ—Ç
                </a>
                <a href="shopping.html" class="px-6 py-3 rounded-2xl bg-white text-blue-600 shadow flex items-center justify-center gap-2">
                    üõçÔ∏è –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫
                </a>
            </div>
        </header>

        <!-- –ë—ã—Å—Ç—Ä–æ –¥–æ–±–∞–≤–∏—Ç—å -->
        <section class="card p-4 space-y-3">
            <div class="flex items-center justify-between text-sm text-gray-500">
                <h2 class="text-lg font-medium text-gray-800">‚ö° –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</h2>
                <span>Enter –≤ –ª—é–±–æ–º –ø–æ–ª–µ –¥–æ–±–∞–≤–∏—Ç –ø–æ–∑–∏—Ü–∏—é</span>
            </div>
            <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-4">
                <input id="itemName" type="text" placeholder="–ß—Ç–æ –∫—É–ø–∏—Ç—å?" class="input-field" />
                <input id="itemQuantity" type="text" placeholder="–°–∫–æ–ª—å–∫–æ?" class="input-field" />
                <input id="itemCategory" type="text" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è" class="input-field" />
                <button id="addItemBtn" class="btn-primary rounded-lg font-medium">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            <div class="flex gap-2 overflow-x-auto text-sm pb-1">
                <button class="chip" onclick="quickAdd('üçû –•–ª–µ–±', '1 —à—Ç', '–ü—Ä–æ–¥—É–∫—Ç—ã')">üçû –•–ª–µ–±</button>
                <button class="chip" onclick="quickAdd('ü•õ –ú–æ–ª–æ–∫–æ', '2 –ª', '–ü—Ä–æ–¥—É–∫—Ç—ã')">ü•õ –ú–æ–ª–æ–∫–æ</button>
                <button class="chip" onclick="quickAdd('ü•ö –Ø–π—Ü–∞', '10 —à—Ç', '–ü—Ä–æ–¥—É–∫—Ç—ã')">ü•ö –Ø–π—Ü–∞</button>
                <button class="chip" onclick="quickAdd('üçé –§—Ä—É–∫—Ç—ã', '1 –∫–≥', '–ü—Ä–æ–¥—É–∫—Ç—ã')">üçé –§—Ä—É–∫—Ç—ã</button>
                <button class="chip" onclick="quickAdd('üßª –ë—É–º–∞–≥–∞', '12 —Ä—É–ª–æ–Ω–æ–≤', '–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è')">üßª –ë—É–º–∞–≥–∞</button>
            </div>
            <div id="manualTemplates" class="flex flex-wrap gap-2 text-sm"></div>
        </section>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–∫—Ç–∏–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫ -->
        <section class="card p-4 space-y-4">
            <div class="grid grid-cols-3 gap-3 text-center text-sm">
                <div class="bg-gray-50 rounded-xl p-3">
                    <div class="text-xs text-gray-500">–í—Å–µ–≥–æ</div>
                    <div id="statTotal" class="text-lg font-semibold text-gray-800">0</div>
                </div>
                <div class="bg-gray-50 rounded-xl p-3">
                    <div class="text-xs text-gray-500">–ê–∫—Ç–∏–≤–Ω–æ</div>
                    <div id="statActive" class="text-lg font-semibold text-blue-600">0</div>
                </div>
                <div class="bg-gray-50 rounded-xl p-3">
                    <div class="text-xs text-gray-500">–ì–æ—Ç–æ–≤–æ</div>
                    <div id="statDone" class="text-lg font-semibold text-green-600">0</div>
                </div>
            </div>
            <div class="flex flex-wrap items-center justify-between gap-2">
                <h2 class="text-lg font-medium text-gray-800">üìù –ê–∫—Ç–∏–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫</h2>
                <button id="clearList" class="text-sm text-red-500">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
            </div>
            <div id="categoryFilterChips" class="flex gap-2 overflow-x-auto pb-1 text-sm"></div>
            <div id="itemsList" class="space-y-2"></div>
            <p class="text-xs text-gray-400 text-center">–°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ –ø–æ –ø–æ–∑–∏—Ü–∏–∏ ‚Äî –æ—Ç–º–µ—Ç–∫–∞ ¬´–∫—É–ø–ª–µ–Ω–æ¬ª</p>
        </section>

        <!-- –ö–∞—Ç–∞–ª–æ–≥ –∏ —Ç–æ–ø -->
        <section class="grid md:grid-cols-2 gap-4">
            <div class="card p-4 space-y-4">
                <div class="flex flex-wrap items-center justify-between gap-2">
                    <h2 class="text-lg font-medium text-gray-800">üìö –ë—ã—Å—Ç—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã</h2>
                    <input id="catalogSearch" type="text" placeholder="–ü–æ–∏—Å–∫..." class="input-field text-sm w-40" />
                </div>
                <div class="space-y-3">
                    <div id="catalogCategoryTabs" class="flex flex-wrap gap-2 text-xs md:text-sm"></div>
                    <div id="catalogGrid" class="catalog-grid"></div>
                </div>
            </div>

            <div class="space-y-4">
                <div class="card p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-lg font-medium text-gray-800">üèÜ –¢–æ–ø –ø–æ–∫—É–ø–æ–∫</h2>
                        <span id="topStatsPeriod" class="text-xs text-gray-500">–ò—Å—Ç–æ—Ä–∏—è</span>
                    </div>
                    <div id="topItemsList" class="space-y-2"></div>
                </div>
                <div class="card p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="text-lg font-medium text-gray-800">üìä –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
                        <span class="text-xs text-gray-500">—á–∞—Å—Ç–æ—Ç–∞</span>
                    </div>
                    <div id="categoriesList" class="space-y-2 text-sm"></div>
                </div>
            </div>
        </section>

        <!-- Telegram -->
        <section class="card p-4 space-y-4">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-medium text-gray-800">üì≤ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤ Telegram</h2>
                <span class="text-xs text-gray-500">–±–æ—Ç + —á–∞—Ç</span>
            </div>
            <p class="text-xs text-gray-500">–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –∏ Chat ID —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ø–∏—Å–∫–∞¬ª.</p>
            <div class="flex flex-wrap gap-2">
                <button onclick="sendTelegramList()" class="btn-primary px-4 py-2 rounded-lg">üí¨ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
            </div>
            <div id="telegramStatus" class="text-sm"></div>
        </section>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <section class="card p-4 space-y-4">
            <details>
                <summary class="text-lg font-medium text-gray-800 cursor-pointer">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ø–∏—Å–∫–∞</summary>
                <div class="mt-4 space-y-3">
                    <div class="grid gap-3 md:grid-cols-2">
                        <div>
                            <label class="text-xs text-gray-500">Bot Token</label>
                            <input id="settingsTelegramToken" type="password" placeholder="123456:ABC..." class="input-field" />
                        </div>
                        <div>
                            <label class="text-xs text-gray-500">Chat ID</label>
                            <input id="settingsTelegramChatId" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 123456789" class="input-field" />
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="saveTelegramSettings()" class="btn-primary px-4 py-2 rounded-lg">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                        <button onclick="testTelegramSettings()" class="btn-secondary px-4 py-2 rounded-lg">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    </div>
                    <p class="text-xs text-gray-500">–•—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ @BotFather –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à —á–∞—Ç.</p>
                </div>
            </details>
        </section>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ -->
    <div id="quantityModal" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-sm p-6 shadow-xl">
            <h3 id="modalTitle" class="text-lg font-medium text-gray-800 mb-2 flex items-center gap-2">üì¶ –î–æ–±–∞–≤–∏—Ç—å –∏–∑ —à–∞–±–ª–æ–Ω–∞</h3>
            <p id="modalItemName" class="text-sm text-gray-600 mb-4"></p>
            <div class="space-y-3">
                <div>
                    <label class="text-xs text-gray-500">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                    <input id="modalQuantity" type="number" min="0" step="0.1" class="input-field mt-1" placeholder="1">
                </div>
                <div>
                    <label class="text-xs text-gray-500">–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è</label>
                    <select id="modalUnit" class="input-field mt-1">
                        <option value="—à—Ç">—à—Ç</option>
                        <option value="—É–ø.">—É–ø.</option>
                        <option value="–∫–≥">–∫–≥</option>
                        <option value="–≥">–≥</option>
                        <option value="–ª">–ª</option>
                        <option value="–º–ª">–º–ª</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs text-gray-500">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <input id="modalCategory" type="text" class="input-field mt-1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ü—Ä–æ–¥—É–∫—Ç—ã">
                </div>
                <p id="modalHint" class="text-xs text-gray-400"></p>
                <div class="flex gap-2 mt-2">
                    <button onclick="confirmModalAction()" class="btn-primary flex-1 px-4 py-2 rounded-lg">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button onclick="closeQuantityModal()" class="btn-secondary px-4 py-2 rounded-lg">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const toast = {
            el: null,
            show(message) {
                if (!this.el) {
                    this.el = document.createElement('div');
                    this.el.className = 'fixed top-6 left-1/2 -translate-x-1/2 bg-gray-900 text-white px-4 py-2 rounded-full shadow-lg text-sm z-50 opacity-0 pointer-events-none transition opacity-0';
                    document.body.appendChild(this.el);
                }
                this.el.textContent = message;
                this.el.style.opacity = '1';
                clearTimeout(this.timer);
                this.timer = setTimeout(() => this.el.style.opacity = '0', 1800);
            }
        };

        const catalogItems = [
            { emoji: 'ü•õ', name: '–ú–æ–ª–æ–∫–æ 2.5%', quantity: '2 –ø–∞–∫–µ—Ç–∞', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'üçû', name: '–•–ª–µ–± —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π', quantity: '1 –±—É—Ö–∞–Ω–∫–∞', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'ü•ö', name: '–Ø–π—Ü–∞ –°1', quantity: '10 —à—Ç', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'üçó', name: '–ö—É—Ä–∏–Ω–æ–µ —Ñ–∏–ª–µ', quantity: '1 –∫–≥', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'ü•î', name: '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å', quantity: '5 –∫–≥', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'ü•ï', name: '–û–≤–æ—â–∏ –¥–ª—è —Å–∞–ª–∞—Ç–∞', quantity: '1 –Ω–∞–±–æ—Ä', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'üßÄ', name: '–°—ã—Ä –≥–∞—É–¥–∞', quantity: '300 –≥', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'üçé', name: '–Ø–±–ª–æ–∫–∏ —Å–ª–∞–¥–∫–∏–µ', quantity: '1 –∫–≥', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'üç§', name: '–†—ã–±–∞/–º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã', quantity: '0.5 –∫–≥', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'üç∂', name: '–ô–æ–≥—É—Ä—Ç—ã –ø–∏—Ç—å–µ–≤—ã–µ', quantity: '4 —à—Ç', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'üß¥', name: '–ì–µ–ª—å –¥–ª—è —Å—Ç–∏—Ä–∫–∏', quantity: '1 –ª', category: '–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è' },
            { emoji: 'üßº', name: '–°—Ä–µ–¥—Å—Ç–≤–æ –¥–ª—è –ø–æ—Å—É–¥—ã', quantity: '1 —Ñ–ª–∞–∫–æ–Ω', category: '–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è' },
            { emoji: 'üßª', name: '–¢—É–∞–ª–µ—Ç–Ω–∞—è –±—É–º–∞–≥–∞', quantity: '12 —Ä—É–ª–æ–Ω–æ–≤', category: '–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è' },
            { emoji: 'ü™•', name: '–ó—É–±–Ω–∞—è –ø–∞—Å—Ç–∞', quantity: '1 —Ç—é–±–∏–∫', category: '–ì–∏–≥–∏–µ–Ω–∞' },
            { emoji: 'ü©π', name: '–ê–ø—Ç–µ—á–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ', quantity: '1 –Ω–∞–±–æ—Ä', category: '–ó–¥–æ—Ä–æ–≤—å–µ' },
            { emoji: 'üçº', name: '–î–µ—Ç—Å–∫–æ–µ –ø–∏—Ç–∞–Ω–∏–µ', quantity: '5 –±–∞–Ω–æ—á–µ–∫', category: '–î–µ—Ç—Å–∫–æ–µ' },
            { emoji: 'üß∏', name: '–ü–æ–¥–≥—É–∑–Ω–∏–∫–∏', quantity: '1 —É–ø–∞–∫–æ–≤–∫–∞', category: '–î–µ—Ç—Å–∫–æ–µ' },
            { emoji: 'üìö', name: '–£—á–µ–±–Ω–∏–∫–∏/—Ç–µ—Ç—Ä–∞–¥–∏', quantity: '–Ω–∞ –º–µ—Å—è—Ü', category: '–£—á—ë–±–∞' },
            { emoji: 'üñäÔ∏è', name: '–ö–∞–Ω—Ü–µ–ª—è—Ä–∏—è', quantity: '–Ω–∞–±–æ—Ä', category: '–£—á—ë–±–∞' },
            { emoji: '‚òï', name: '–ö–æ—Ñ–µ –º–æ–ª–æ—Ç—ã–π', quantity: '500 –≥', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'üç´', name: '–°–ª–∞–¥–æ—Å—Ç–∏ –∫ —á–∞–µ–ø–∏—Ç–∏—é', quantity: '–Ω–∞ –Ω–µ–¥–µ–ª—é', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'üßÇ', name: '–°–ø–µ—Ü–∏–∏ –Ω–∞–±–æ—Ä', quantity: '5 –ø–æ–∑–∏—Ü–∏–π', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'üßä', name: '–ó–∞–º–æ—Ä–æ–∑–∫–∞ –æ–≤–æ—â–∏', quantity: '3 –ø–∞–∫–µ—Ç–∞', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'üç∫', name: '–ù–∞–ø–∏—Ç–∫–∏ –±–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–µ', quantity: '6 —à—Ç', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'ü™ë', name: '–•–æ–∑—Ç–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞', quantity: '–ø–æ —Å–ø–∏—Å–∫—É', category: '–î–æ–º' },
            { emoji: 'üßΩ', name: '–ì—É–±–∫–∏/—Å–∞–ª—Ñ–µ—Ç–∫–∏', quantity: '5 —à—Ç', category: '–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è' },
            { emoji: 'üêæ', name: '–ö–æ—Ä–º –¥–ª—è –ø–∏—Ç–æ–º—Ü–∞', quantity: '1 –º–µ—à–æ–∫', category: '–ó–æ–æ—Ç–æ–≤–∞—Ä—ã' },
            { emoji: 'üéÇ', name: '–ü—Ä–æ–¥—É–∫—Ç—ã –∫ –ø—Ä–∞–∑–¥–Ω–∏–∫—É', quantity: '—Å–ø–∏—Å–æ–∫', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'ü•ó', name: '–ó–û–ñ-–Ω–∞–±–æ—Ä', quantity: '–æ–≤–æ—â–∏ –∏ –∫—Ä—É–ø—ã', category: '–ü—Ä–æ–¥—É–∫—Ç—ã' },
            { emoji: 'üçΩÔ∏è', name: '–û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –ø–æ—Å—É–¥–∞', quantity: '–Ω–∞ 10 –ø–µ—Ä—Å–æ–Ω', category: '–î–æ–º' }
        ];

        let shoppingItems = [];
        let manualTemplates = [];
        if (!Array.isArray(manualTemplates)) manualTemplates = [];
        let activeCategoryFilter = '';
        let activeCatalogCategory = '';
        const categoriesSet = new Set();

        const elements = {
            list: document.getElementById('itemsList'),
            categoryFilter: document.getElementById('categoryFilterChips'),
            catalogTabs: document.getElementById('catalogCategoryTabs'),
            catalogGrid: document.getElementById('catalogGrid'),
            catalogSearch: document.getElementById('catalogSearch'),
            categoriesSummary: document.getElementById('categoriesList'),
            topList: document.getElementById('topItemsList'),
            statTotal: document.getElementById('statTotal'),
            statActive: document.getElementById('statActive'),
            statDone: document.getElementById('statDone'),
            manualTemplates: document.getElementById('manualTemplates'),
            settingsTelegramToken: document.getElementById('settingsTelegramToken'),
            settingsTelegramChatId: document.getElementById('settingsTelegramChatId'),
            telegramStatus: document.getElementById('telegramStatus')
        };

        document.getElementById('addItemBtn').addEventListener('click', () => handleAddItem());
        document.getElementById('catalogSearch').addEventListener('input', renderCatalog);
        document.getElementById('clearList').addEventListener('click', clearList);
        ['itemName', 'itemQuantity', 'itemCategory'].forEach(id => {
            document.getElementById(id).addEventListener('keypress', e => {
                if (e.key === 'Enter') handleAddItem();
            });
        });

        function handleAddItem(template = null) {
            const source = template || {
                name: document.getElementById('itemName').value.trim(),
                quantity: document.getElementById('itemQuantity').value.trim(),
                category: document.getElementById('itemCategory').value.trim()
            };
            if (!source.name) return;
            const newItem = { id: Date.now(), name: source.name, quantity: source.quantity, category: source.category, done: false, createdAt: new Date() };
            shoppingItems.unshift(newItem);
            saveShoppingToRoom();
            if (source.category) categoriesSet.add(source.category);
            if (activeCategoryFilter && source.category !== activeCategoryFilter) activeCategoryFilter = '';
            if (!template) saveManualTemplate(newItem);
            renderAll();
            toast.show('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å–ø–∏—Å–æ–∫');
            if (!template) {
                document.getElementById('itemName').value = '';
                document.getElementById('itemQuantity').value = '';
                document.getElementById('itemCategory').value = '';
            }
        }

        function saveManualTemplate(item) {
            const exists = manualTemplates.some(t => t.name === item.name && t.category === item.category);
            if (exists) return;
            manualTemplates.unshift({ name: item.name, quantity: item.quantity, category: item.category });
            manualTemplates = manualTemplates.slice(0, 15);
            localStorage.setItem('manualTemplates', JSON.stringify(manualTemplates));
            renderManualTemplates();
        }

        function renderManualTemplates() {
            if (!manualTemplates.length) {
                elements.manualTemplates.innerHTML = '';
                return;
            }
            elements.manualTemplates.innerHTML = manualTemplates.map((tpl, index) => `
                <div class="relative inline-flex items-center">
                    <button class="chip pr-6" onclick="applyManualTemplate(${index})">${tpl.name}${tpl.quantity ? ` ¬∑ ${tpl.quantity}` : ''}</button>
                    <button class="absolute -right-1 -top-1 bg-red-500 text-white rounded-full w-5 h-5 text-[10px] flex items-center justify-center shadow" onclick="removeManualTemplate(${index})">‚úï</button>
                </div>
            `).join('');
        }

        function applyManualTemplate(index) {
            const tpl = manualTemplates[index];
            handleAddItem(tpl);
        }

        function removeManualTemplate(index) {
            manualTemplates.splice(index, 1);
            localStorage.setItem('manualTemplates', JSON.stringify(manualTemplates));
            renderManualTemplates();
        }

        const UNIT_HINTS = {
            '–º–æ–ª–æ–∫–æ': '–ª',
            '–π–æ–≥—É—Ä—Ç': '—à—Ç',
            '–∫–µ—Ñ–∏—Ä': '–ª',
            '—Ö–ª–µ–±': '—à—Ç',
            '–±—É–ª–∫–∞': '—à—Ç',
            '—è–π—Ü': '—à—Ç',
            '—Ñ–∏–ª–µ': '–∫–≥',
            '–∫—É—Ä–∏–Ω': '–∫–≥',
            '–∫–∞—Ä—Ç–æ—Ñ': '–∫–≥',
            '–æ–≤–æ—â': '–∫–≥',
            '—Ñ—Ä—É–∫—Ç': '–∫–≥',
            '—è–±–ª–æ–∫': '–∫–≥',
            '–±–∞–Ω–∞–Ω': '–∫–≥',
            '—Å—ã—Ä': '–≥',
            '–∫–æ–ª–±–∞—Å': '–≥',
            '–±–µ–∫–æ–Ω': '–≥',
            '—Ä—ã–±': '–≥',
            '–º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç': '–≥',
            '–Ω–∞–ø–∏—Ç–∫': '–ª',
            '–≤–æ–¥–∞': '–ª',
            '—Å–æ–∫': '–ª',
            '–∫–æ—Ñ–µ': '–≥',
            '—á–∞–π': '–≥',
            '—Å–ø–µ—Ü–∏': '–≥',
            '–ø–æ–¥–≥—É–∑': '—à—Ç',
            '—Å–∞–ª—Ñ–µ—Ç–∫': '—à—Ç',
            '–≥—É–±–∫': '—à—Ç',
            '–ø–∞–∫–µ—Ç': '—à—Ç',
            '–ø–∞—Å—Ç–∞': '—à—Ç',
            '—à–∞–º–ø—É–Ω': '–º–ª',
            '–≥–µ–ª—å': '–º–ª',
            '–º–æ—é—â–µ–µ': '–º–ª',
            '–ø–æ—Ä–æ—à': '–∫–≥'
        };

        let pendingCatalogItem = null;
        let editItemId = null;

        function openQuantityModal({ title, name, category, quantity, unit, hintText }) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalItemName').textContent = name || '';
            document.getElementById('modalUnit').value = unit || '—à—Ç';
            document.getElementById('modalQuantity').value = quantity || '';
            document.getElementById('modalCategory').value = category || '';
            document.getElementById('modalHint').textContent = hintText || '';
            document.getElementById('quantityModal').classList.remove('hidden');
        }

        function addFromCatalog(index) {
            const item = catalogItems[index];
            pendingCatalogItem = item;
            editItemId = null;
            const hint = getUnitForItem(item.name);
            openQuantityModal({
                title: 'üì¶ –î–æ–±–∞–≤–∏—Ç—å –∏–∑ —à–∞–±–ª–æ–Ω–∞',
                name: `${item.emoji} ${item.name}`,
                category: item.category,
                quantity: hint.defaultQuantity,
                unit: hint.unit,
                hintText: hint.hintText
            });
        }

        function getUnitForItem(name) {
            const lower = name.toLowerCase();
            for (const [key, unit] of Object.entries(UNIT_HINTS)) {
                if (lower.includes(key)) {
                    const defaults = {
                        '—à—Ç': '1',
                        '—É–ø.': '1',
                        '–∫–≥': '1',
                        '–≥': '500',
                        '–ª': '1',
                        '–º–ª': '500'
                    };
                    return {
                        unit,
                        defaultQuantity: defaults[unit] || '1',
                        hintText: `–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ: ${unit}`
                    };
                }
            }
            return { unit: '—à—Ç', defaultQuantity: '1', hintText: '–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é' };
        }

        function closeQuantityModal() {
            document.getElementById('quantityModal').classList.add('hidden');
            pendingCatalogItem = null;
            editItemId = null;
        }

        function confirmModalAction() {
            const qty = document.getElementById('modalQuantity').value.trim();
            const unit = document.getElementById('modalUnit').value;
            const category = document.getElementById('modalCategory').value.trim();
            const quantityText = qty ? `${qty} ${unit}` : '';

            if (editItemId) {
                const item = shoppingItems.find(i => i.id === editItemId);
                if (item) {
                    item.quantity = quantityText;
                    item.category = category;
                    toast.show('–û–±–Ω–æ–≤–ª–µ–Ω–æ');
                }
                renderAll();
                closeQuantityModal();
                return;
            }

            if (!pendingCatalogItem) return;
            handleAddItem({
                name: `${pendingCatalogItem.emoji} ${pendingCatalogItem.name}`,
                quantity: quantityText,
                category: category || pendingCatalogItem.category
            });
            closeQuantityModal();
        }

        function quickAdd(name, quantity = '', category = '') {
            handleAddItem({ name, quantity, category });
        }

        function toggleItem(id) {
            const item = shoppingItems.find(i => i.id === id);
            if (item) {
                item.done = !item.done;
                renderAll();
            }
        }

        function editItem(id) {
            const item = shoppingItems.find(i => i.id === id);
            if (!item) return;
            const { unit, base } = parseQuantity(item.quantity);
            editItemId = id;
            pendingCatalogItem = null;
            openQuantityModal({
                title: '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é',
                name: item.name,
                category: item.category,
                quantity: base,
                unit,
                hintText: '–ò–∑–º–µ–Ω–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é'
            });
        }

        function parseQuantity(quantity = '') {
            if (!quantity) return { base: '', unit: '—à—Ç' };
            const match = quantity.match(/([\d.,]+)/);
            const num = match ? match[1].replace(',', '.') : '';
            const unit = quantity.replace(match ? match[1] : '', '').trim() || '—à—Ç';
            return { base: num, unit };
        }

        function removeItem(id) {
            shoppingItems = shoppingItems.filter(i => i.id !== id);
            renderAll();
        }

        function clearList() {
            if (!shoppingItems.length) return;
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫?')) {
                shoppingItems = [];
                categoriesSet.clear();
                renderAll();
                localStorage.setItem('shoppingItems', '[]');
            }
        }

        function setCategoryFilter(value) {
            activeCategoryFilter = value === '–í—Å–µ' ? '' : value;
            renderCategoryFilters();
            renderItems();
        }

        function handleCategoryFilterClick(btn) {
            const value = btn.getAttribute('data-category');
            setCategoryFilter(value);
        }

        function setCatalogCategory(value) {
            activeCatalogCategory = value === '–í—Å–µ' ? '' : value;
            renderCatalogTabs();
            renderCatalog();
        }

        function handleCatalogCategoryClick(btn) {
            const value = btn.getAttribute('data-category');
            setCatalogCategory(value);
        }

        function renderStats() {
            const total = shoppingItems.length;
            const done = shoppingItems.filter(item => item.done).length;
            const active = total - done;
            elements.statTotal.textContent = total;
            elements.statActive.textContent = active;
            elements.statDone.textContent = done;
        }

        function renderCategoryFilters() {
            const categories = ['–í—Å–µ', ...Array.from(categoriesSet).sort()];
            elements.categoryFilter.innerHTML = categories.map(cat => {
                const isActive = (cat === '–í—Å–µ' && !activeCategoryFilter) || activeCategoryFilter === cat;
                const classes = isActive ? 'bg-blue-600 text-white border-blue-600' : 'text-gray-600 border-gray-200';
                const safeValue = cat.replace(/"/g, '&quot;');
                return `<button class="px-3 py-1 rounded-full border text-sm whitespace-nowrap ${classes}" data-category="${safeValue}" onclick="handleCategoryFilterClick(this)">${cat}</button>`;
            }).join('');
        }

        function renderItems() {
            let filtered = shoppingItems;
            if (activeCategoryFilter) filtered = filtered.filter(item => item.category === activeCategoryFilter);
            elements.list.innerHTML = filtered.length ? filtered.map(item => `
                <div class="shopping-item flex items-center justify-between gap-3 rounded-2xl border px-3 py-3 ${item.done ? 'bg-gray-50 opacity-70' : 'bg-white'}" data-id="${item.id}" onclick="editItem(${item.id})">
                    <div>
                        <p class="text-gray-800 font-medium ${item.done ? 'line-through' : ''}">${item.name}</p>
                        <div class="flex flex-wrap items-center gap-2 text-xs text-gray-500 mt-1">
                            ${item.category ? `<span class="px-2 py-0.5 bg-gray-100 rounded-full">${item.category}</span>` : '<span class="px-2 py-0.5 bg-gray-100 rounded-full">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>'}
                            ${item.quantity ? `<span>${item.quantity}</span>` : ''}
                        </div>
                    </div>
                    <div class="flex flex-col gap-2 text-sm">
                        <button onclick="event.stopPropagation(); toggleItem(${item.id})" class="btn-secondary px-3 py-1 rounded-lg">${item.done ? '‚Ü©Ô∏è' : '‚úÖ'}</button>
                        <button onclick="event.stopPropagation(); removeItem(${item.id})" class="text-red-500">‚úï</button>
                    </div>
                </div>
            `).join('') : '<p class="text-gray-400 text-center py-4">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –ø–æ–∑–∏—Ü–∏—é</p>';
            attachSwipeHandlers();
        }

        function attachSwipeHandlers() {
            let startX = 0;
            let currentId = null;
            document.querySelectorAll('.shopping-item').forEach(card => {
                card.addEventListener('touchstart', e => {
                    startX = e.touches[0].clientX;
                    currentId = Number(card.dataset.id);
                    card.classList.remove('swiped');
                }, { passive: true });
                card.addEventListener('touchmove', e => {
                    const delta = e.touches[0].clientX - startX;
                    if (delta > 40) card.classList.add('swiped');
                }, { passive: true });
                card.addEventListener('touchend', e => {
                    const endX = e.changedTouches[0].clientX;
                    if (endX - startX > 60 && currentId) toggleItem(currentId);
                    card.classList.remove('swiped');
                });
            });
        }

        function renderCatalogTabs() {
            const categories = ['–í—Å–µ', ...new Set(catalogItems.map(item => item.category))];
            elements.catalogTabs.innerHTML = categories.map(cat => {
                const isActive = (cat === '–í—Å–µ' && !activeCatalogCategory) || activeCatalogCategory === cat;
                const classes = isActive ? 'bg-purple-600 text-white border-purple-600' : 'text-gray-600 border-gray-200';
                const safeValue = cat.replace(/"/g, '&quot;');
                return `<button class="px-3 py-1 rounded-full border text-sm whitespace-nowrap ${classes}" data-category="${safeValue}" onclick="handleCatalogCategoryClick(this)">${cat}</button>`;
            }).join('');
        }

        function renderCatalog() {
            const term = elements.catalogSearch.value.toLowerCase();
            const filtered = catalogItems.filter(item =>
                (!activeCatalogCategory || item.category === activeCatalogCategory) &&
                (item.name.toLowerCase().includes(term) || item.category.toLowerCase().includes(term))
            );
            elements.catalogGrid.innerHTML = filtered.length ? filtered.map(item => {
                const index = catalogItems.indexOf(item);
                return `<div class="catalog-card">
                    <div class="catalog-icon">${item.emoji}</div>
                    <div class="catalog-text">
                        <div class="catalog-meta">${item.category}</div>
                        <div class="catalog-title">${item.name}</div>
                    </div>
                    <button onclick="addFromCatalog(${index})" class="btn-secondary text-xs px-2">+ –í —Å–ø–∏—Å–æ–∫</button>
                </div>`;
            }).join('') : '<p class="text-gray-400 text-center py-4">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
        }

        function renderTopItems() {
            const counts = shoppingItems.reduce((acc, item) => {
                const key = item.name;
                if (!acc[key]) acc[key] = { name: item.name, count: 0, category: item.category, quantity: item.quantity };
                acc[key].count++;
                return acc;
            }, {});
            const sorted = Object.values(counts).sort((a, b) => b.count - a.count).slice(0, 5);
            elements.topList.innerHTML = sorted.length ? sorted.map(item => `
                <div class="border rounded-2xl px-3 py-2 bg-white flex items-center justify-between">
                    <div>
                        <div class="font-medium text-gray-800">${item.name}</div>
                        <div class="text-xs text-gray-500">${item.category || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'} ${item.quantity ? '¬∑ ' + item.quantity : ''}</div>
                    </div>
                    <button onclick="addTopItem('${item.name.replace(/'/g, "\\'")}')" class="btn-secondary text-sm rounded-lg px-3 py-1">‚Ü©Ô∏è</button>
                </div>
            `).join('') : '<p class="text-gray-400 text-center py-4">–ò—Å—Ç–æ—Ä–∏–∏ –µ—â—ë –Ω–µ—Ç</p>';
        }

        function renderCategoriesList() {
            const grouped = shoppingItems.reduce((acc, item) => {
                const cat = item.category || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
                acc[cat] = (acc[cat] || 0) + 1;
                return acc;
            }, {});
            const sorted = Object.entries(grouped).sort((a, b) => b[1] - a[1]).slice(0, 6);
            elements.categoriesSummary.innerHTML = sorted.length ? sorted.map(([cat, count]) => `
                <div class="flex items-center justify-between border rounded-2xl px-3 py-2 bg-gray-50">
                    <span class="text-gray-700">${cat}</span>
                    <span class="text-sm text-gray-500">${count} —à—Ç.</span>
                </div>
            `).join('') : '<p class="text-gray-400 text-center py-4">–î–æ–±–∞–≤—å—Ç–µ –ø–æ–∑–∏—Ü–∏–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ç–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π</p>';
        }

        function addTopItem(name) {
            const found = shoppingItems.find(item => item.name === name) || manualTemplates.find(item => item.name === name);
            const base = found || { name, quantity: '', category: '' };
            handleAddItem(base);
        }

        function sendTelegramList() {
            const token = (elements.settingsTelegramToken.value || '').trim();
            const chatId = (elements.settingsTelegramChatId.value || '').trim();
            if (!token || !chatId) {
                elements.telegramStatus.textContent = '‚öôÔ∏è –°–Ω–∞—á–∞–ª–∞ —É–∫–∞–∂–∏—Ç–µ Bot Token –∏ Chat ID –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –Ω–∏–∂–µ';
                elements.telegramStatus.className = 'text-sm text-red-600';
                return;
            }
            if (!shoppingItems.length) {
                elements.telegramStatus.textContent = '‚ö†Ô∏è –°–ø–∏—Å–æ–∫ –ø—É—Å—Ç–æ–π';
                elements.telegramStatus.className = 'text-sm text-red-600';
                return;
            }
            const lines = shoppingItems.map((item, i) => `${i + 1}. ${item.name}${item.quantity ? ' ‚Äî ' + item.quantity : ''}${item.category ? ' (' + item.category + ')' : ''}${item.done ? ' ‚úÖ' : ''}`);
            const message = `üõçÔ∏è –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫\n${lines.join('\n')}`;
            elements.telegramStatus.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è—é...';
            elements.telegramStatus.className = 'text-sm text-blue-600';
            fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: chatId, text: message })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.ok) {
                        elements.telegramStatus.textContent = '‚úÖ –°–ø–∏—Å–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω';
                        elements.telegramStatus.className = 'text-sm text-green-600';
                    } else {
                        throw new Error(data.description || '–û—à–∏–±–∫–∞ Telegram');
                    }
                })
                .catch(err => {
                    elements.telegramStatus.textContent = `‚ùå ${err.message}`;
                    elements.telegramStatus.className = 'text-sm text-red-600';
                });
        }

        function saveTelegramSettings() {
            const token = elements.settingsTelegramToken.value.trim();
            const chatId = elements.settingsTelegramChatId.value.trim();
            if (!token || !chatId) {
                elements.telegramStatus.textContent = '‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ Chat ID';
                elements.telegramStatus.className = 'text-sm text-red-600';
                return;
            }
            localStorage.setItem('telegramToken', token);
            localStorage.setItem('telegramChatId', chatId);
            elements.telegramStatus.textContent = 'üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã';
            elements.telegramStatus.className = 'text-sm text-green-600';
        }

        function testTelegramSettings() {
            const token = elements.settingsTelegramToken.value.trim();
            const chatId = elements.settingsTelegramChatId.value.trim();
            if (!token || !chatId) {
                elements.telegramStatus.textContent = '‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ Chat ID';
                elements.telegramStatus.className = 'text-sm text-red-600';
                return;
            }
            elements.telegramStatus.textContent = 'üîç –ü—Ä–æ–≤–µ—Ä—è—é...';
            elements.telegramStatus.className = 'text-sm text-blue-600';
            fetch(`https://api.telegram.org/bot${token}/getMe`)
                .then(res => res.json())
                .then(data => {
                    if (!data.ok) throw new Error(data.description || '–û—à–∏–±–∫–∞ –±–æ—Ç–∞');
                    elements.telegramStatus.textContent = '‚úÖ –ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫!';
                    elements.telegramStatus.className = 'text-sm text-green-600';
                })
                .catch(err => {
                    elements.telegramStatus.textContent = `‚ùå ${err.message}`;
                    elements.telegramStatus.className = 'text-sm text-red-600';
                });
        }

        function loadTelegramSettings() {
            const token = localStorage.getItem('telegramToken') || '';
            const chatId = localStorage.getItem('telegramChatId') || '';
            elements.settingsTelegramToken.value = token;
            elements.settingsTelegramChatId.value = chatId;
        }

        function renderAll() {
            shoppingItems.forEach(item => {
                if (item.category) categoriesSet.add(item.category);
            });
            renderStats();
            renderCategoryFilters();
            renderItems();
            renderTopItems();
            renderCategoriesList();
            renderCatalogTabs();
            renderCatalog();
            localStorage.setItem('shoppingItems', JSON.stringify(shoppingItems));
        }

        renderManualTemplates();
        loadTelegramSettings();
        renderAll();

        window.quickAdd = quickAdd;
        window.toggleItem = toggleItem;
        window.removeItem = removeItem;
        window.editItem = editItem;
        window.addFromCatalog = addFromCatalog;
        window.addTopItem = addTopItem;
        window.setCategoryFilter = setCategoryFilter;
        window.setCatalogCategory = setCatalogCategory;
        window.handleCategoryFilterClick = handleCategoryFilterClick;
        window.handleCatalogCategoryClick = handleCatalogCategoryClick;
        window.applyManualTemplate = applyManualTemplate;
        window.removeManualTemplate = removeManualTemplate;
        window.sendTelegramList = sendTelegramList;
        window.saveTelegramSettings = saveTelegramSettings;
        window.clearList = clearList;
    </script>
</body>
</html>
